(()=>{var e={};e.id=163,e.ids=[163],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},49614:e=>{function t(e){return Array.isArray(e)?e:[e]}let r=void 0,a=/^\s+$/,n=/(?:[^\\]|^)\\$/,s=/^\\!/,o=/^\\#/,i=/\r?\n/g,l=/^\.*\/|^\.+$/,u=/\/$/,c="node-ignore";"undefined"!=typeof Symbol&&(c=Symbol.for("node-ignore"));let p=c,d=(e,t,r)=>(Object.defineProperty(e,t,{value:r}),r),m=/([0-z])-([0-z])/g,h=()=>!1,f=e=>e.replace(m,(e,t,r)=>t.charCodeAt(0)<=r.charCodeAt(0)?e:""),g=e=>{let{length:t}=e;return e.slice(0,t-t%2)},y=[[/^\uFEFF/,()=>""],[/((?:\\\\)*?)(\\?\s+)$/,(e,t,r)=>t+(0===r.indexOf("\\")?" ":"")],[/(\\+?)\s/g,(e,t)=>{let{length:r}=t;return t.slice(0,r-r%2)+" "}],[/[\\$.|*+(){^]/g,e=>`\\${e}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return/\/(?!$)/.test(this)?"^":"(?:^|\\/)"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(e,t,r)=>t+6<r.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(e,t,r)=>t+r.replace(/\\\*/g,"[^\\/]*")],[/\\\\\\(?=[$.|*+(){^])/g,()=>"\\"],[/\\\\/g,()=>"\\"],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(e,t,r,a,n)=>"\\"===t?`\\[${r}${g(a)}${n}`:"]"===n&&a.length%2==0?`[${f(r)}${a}]`:"[]"],[/(?:[^*])$/,e=>/\/$/.test(e)?`${e}$`:`${e}(?=$|\\/$)`]],v=/(^|\\\/)?\\\*$/,b="regex",w="checkRegex",x={[b](e,t){let r=t?`${t}[^/]+`:"[^/]*";return`${r}(?=$|\\/$)`},[w](e,t){let r=t?`${t}[^/]*`:"[^/]*";return`${r}(?=$|\\/$)`}},_=e=>y.reduce((t,[r,a])=>t.replace(r,a.bind(e)),e),T=e=>"string"==typeof e,k=e=>e&&T(e)&&!a.test(e)&&!n.test(e)&&0!==e.indexOf("#"),S=e=>e.split(i).filter(Boolean);class A{constructor(e,t,r,a,n,s){this.pattern=e,this.mark=t,this.negative=n,d(this,"body",r),d(this,"ignoreCase",a),d(this,"regexPrefix",s)}get regex(){let e="_"+b;return this[e]?this[e]:this._make(b,e)}get checkRegex(){let e="_"+w;return this[e]?this[e]:this._make(w,e)}_make(e,t){let r=this.regexPrefix.replace(v,x[e]);return d(this,t,this.ignoreCase?RegExp(r,"i"):new RegExp(r))}}let I=({pattern:e,mark:t},r)=>{let a=!1,n=e;0===n.indexOf("!")&&(a=!0,n=n.substr(1));let i=_(n=n.replace(s,"!").replace(o,"#"));return new A(e,t,n,r,a,i)};class E{constructor(e){this._ignoreCase=e,this._rules=[]}_add(e){if(e&&e[p]){this._rules=this._rules.concat(e._rules._rules),this._added=!0;return}if(T(e)&&(e={pattern:e}),k(e.pattern)){let t=I(e,this._ignoreCase);this._added=!0,this._rules.push(t)}}add(e){return this._added=!1,t(T(e)?S(e):e).forEach(this._add,this),this._added}test(e,t,a){let n,s=!1,o=!1;this._rules.forEach(i=>{let{negative:l}=i;(o!==l||s===o)&&(!l||s||o||t)&&i[a].test(e)&&(s=!l,o=l,n=l?r:i)});let i={ignored:s,unignored:o};return n&&(i.rule=n),i}}let R=(e,t)=>{throw new t(e)},N=(e,t,r)=>T(e)?e?!N.isNotRelative(e)||r(`path should be a \`path.relative()\`d string, but got "${t}"`,RangeError):r("path must not be empty",TypeError):r(`path must be a string, but got \`${t}\``,TypeError),C=e=>l.test(e);N.isNotRelative=C,N.convert=e=>e;class P{constructor({ignorecase:e=!0,ignoreCase:t=e,allowRelativePaths:r=!1}={}){d(this,p,!0),this._rules=new E(t),this._strictPathCheck=!r,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}add(e){return this._rules.add(e)&&this._initCache(),this}addPattern(e){return this.add(e)}_test(e,t,r,a){let n=e&&N.convert(e);return N(n,e,this._strictPathCheck?R:h),this._t(n,t,r,a)}checkIgnore(e){if(!u.test(e))return this.test(e);let t=e.split("/").filter(Boolean);if(t.pop(),t.length){let e=this._t(t.join("/")+"/",this._testCache,!0,t);if(e.ignored)return e}return this._rules.test(e,!1,w)}_t(e,t,r,a){if(e in t)return t[e];if(a||(a=e.split("/").filter(Boolean)),a.pop(),!a.length)return t[e]=this._rules.test(e,r,b);let n=this._t(a.join("/")+"/",t,r,a);return t[e]=n.ignored?n:this._rules.test(e,r,b)}ignores(e){return this._test(e,this._ignoreCache,!1).ignored}createFilter(){return e=>!this.ignores(e)}filter(e){return t(e).filter(this.createFilter())}test(e){return this._test(e,this._testCache,!0)}}let O=e=>new P(e);if("undefined"!=typeof process&&(process.env&&process.env.IGNORE_TEST_WIN32||"win32"===process.platform)){N.convert=e=>/^\\\\\?\\/.test(e)||/["<>|\u0000-\u001F]+/u.test(e)?e:e.replace(/\\/g,"/");let e=/^[a-z]:\//i;N.isNotRelative=t=>e.test(t)||C(t)}e.exports=O,O.default=O,e.exports.isPathValid=e=>N(e&&N.convert(e),e,h)},51850:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=51850,e.exports=t},53752:(e,t,r)=>{"use strict";let a;r.r(t),r.d(t,{patchFetch:()=>aO,routeModule:()=>aR,serverHooks:()=>aP,workAsyncStorage:()=>aN,workUnitAsyncStorage:()=>aC});var n,s,o,i,l,u,c,p,d,m,h,f,g,y,v,b,w={};r.r(w);var x={};r.r(x),r.d(x,{GET:()=>aS,POST:()=>aE});var _=r(18684),T=r(26561),k=r(14488),S=r(18723),A=r(45190),I=r(57495),E=r(2837),R=r(92810);let N=Symbol("Let zodToJsonSchema decide on which parser to use"),C={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},P=e=>"string"==typeof e?{...C,name:e}:{...C,...e},O=e=>{let t=P(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}};function j(e,t,r,a){a?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function M(e,t,r,a,n){e[t]=r,j(e,t,a,n)}function z(e,t){return ee(e.type._def,t)}let D=(e,t)=>ee(e.innerType._def,t),$=(e,t)=>{let r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(let a of e.checks)switch(a.kind){case"min":M(r,"minimum",a.value,a.message,t);break;case"max":M(r,"maximum",a.value,a.message,t)}return r},L=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e,q={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===a&&(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function U(e,t){let r={type:"string"};if(e.checks)for(let a of e.checks)switch(a.kind){case"min":M(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t);break;case"max":M(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":Z(r,"email",a.message,t);break;case"format:idn-email":Z(r,"idn-email",a.message,t);break;case"pattern:zod":B(r,q.email,a.message,t)}break;case"url":Z(r,"uri",a.message,t);break;case"uuid":Z(r,"uuid",a.message,t);break;case"regex":B(r,a.regex,a.message,t);break;case"cuid":B(r,q.cuid,a.message,t);break;case"cuid2":B(r,q.cuid2,a.message,t);break;case"startsWith":B(r,RegExp(`^${F(a.value,t)}`),a.message,t);break;case"endsWith":B(r,RegExp(`${F(a.value,t)}$`),a.message,t);break;case"datetime":Z(r,"date-time",a.message,t);break;case"date":Z(r,"date",a.message,t);break;case"time":Z(r,"time",a.message,t);break;case"duration":Z(r,"duration",a.message,t);break;case"length":M(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t),M(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"includes":B(r,RegExp(F(a.value,t)),a.message,t);break;case"ip":"v6"!==a.version&&Z(r,"ipv4",a.message,t),"v4"!==a.version&&Z(r,"ipv6",a.message,t);break;case"base64url":B(r,q.base64url,a.message,t);break;case"jwt":B(r,q.jwt,a.message,t);break;case"cidr":"v6"!==a.version&&B(r,q.ipv4Cidr,a.message,t),"v4"!==a.version&&B(r,q.ipv6Cidr,a.message,t);break;case"emoji":B(r,q.emoji(),a.message,t);break;case"ulid":B(r,q.ulid,a.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":Z(r,"binary",a.message,t);break;case"contentEncoding:base64":M(r,"contentEncoding","base64",a.message,t);break;case"pattern:zod":B(r,q.base64,a.message,t)}break;case"nanoid":B(r,q.nanoid,a.message,t);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}function F(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)Y.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let Y=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Z(e,t,r,a){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):M(e,"format",t,r,a)}function B(e,t,r,a){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:J(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):M(e,"pattern",J(t,a),r,a)}function J(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=r.i?e.source.toLowerCase():e.source,n="",s=!1,o=!1,i=!1;for(let e=0;e<a.length;e++){if(s){n+=a[e],s=!1;continue}if(r.i){if(o){if(a[e].match(/[a-z]/)){i?(n+=a[e],n+=`${a[e-2]}-${a[e]}`.toUpperCase(),i=!1):"-"===a[e+1]&&a[e+2]?.match(/[a-z]/)?(n+=a[e],i=!0):n+=`${a[e]}${a[e].toUpperCase()}`;continue}}else if(a[e].match(/[a-z]/)){n+=`[${a[e]}${a[e].toUpperCase()}]`;continue}}if(r.m){if("^"===a[e]){n+=`(^|(?<=[\r
]))`;continue}if("$"===a[e]){n+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===a[e]){n+=o?`${a[e]}\r
`:`[${a[e]}\r
]`;continue}n+=a[e],"\\"===a[e]?s=!0:o&&"]"===a[e]?o=!1:o||"["!==a[e]||(o=!0)}try{new RegExp(n)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return n}function V(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===R.kY.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,a)=>({...r,[a]:ee(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??{}}),{}),additionalProperties:!1};let r={type:"object",additionalProperties:ee(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===R.kY.ZodString&&e.keyType._def.checks?.length){let{type:a,...n}=U(e.keyType._def,t);return{...r,propertyNames:n}}if(e.keyType?._def.typeName===R.kY.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===R.kY.ZodBranded&&e.keyType._def.type._def.typeName===R.kY.ZodString&&e.keyType._def.type._def.checks?.length){let{type:a,...n}=z(e.keyType._def,t);return{...r,propertyNames:n}}return r}let W={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},H=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>ee(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0},K=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return ee(e.innerType._def,t);let r=ee(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},G=(e,t)=>{if("input"===t.pipeStrategy)return ee(e.in._def,t);if("output"===t.pipeStrategy)return ee(e.out._def,t);let r=ee(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),a=ee(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,a].filter(e=>void 0!==e)}},X=(e,t)=>ee(e.innerType._def,t),Q=(e,t,r)=>{switch(t){case R.kY.ZodString:return U(e,r);case R.kY.ZodNumber:return function(e,t){let r={type:"number"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"int":r.type="integer",j(r,"type",a.message,t);break;case"min":"jsonSchema7"===t.target?a.inclusive?M(r,"minimum",a.value,a.message,t):M(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),M(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?M(r,"maximum",a.value,a.message,t):M(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),M(r,"maximum",a.value,a.message,t));break;case"multipleOf":M(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case R.kY.ZodObject:return function(e,t){let r="openAi"===t.target,a={type:"object",...Object.entries(e.shape()).reduce((e,[a,n])=>{if(void 0===n||void 0===n._def)return e;let s=n.isOptional();s&&r&&(n instanceof R.Ii&&(n=n._def.innerType),n.isNullable()||(n=n.nullable()),s=!1);let o=ee(n._def,{...t,currentPath:[...t.currentPath,"properties",a],propertyPath:[...t.currentPath,"properties",a]});return void 0===o?e:{properties:{...e.properties,[a]:o},required:s?e.required:[...e.required,a]}},{properties:{},required:[]}),additionalProperties:"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:ee(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:ee(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0};return a.required.length||delete a.required,a}(e,r);case R.kY.ZodBigInt:return function(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"min":"jsonSchema7"===t.target?a.inclusive?M(r,"minimum",a.value,a.message,t):M(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),M(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?M(r,"maximum",a.value,a.message,t):M(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),M(r,"maximum",a.value,a.message,t));break;case"multipleOf":M(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case R.kY.ZodBoolean:return{type:"boolean"};case R.kY.ZodDate:return function e(t,r,a){let n=a??r.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,n)=>e(t,r,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return $(t,r)}}(e,r);case R.kY.ZodUndefined:return{not:{}};case R.kY.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case R.kY.ZodArray:return function(e,t){let r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==R.kY.ZodAny&&(r.items=ee(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&M(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&M(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(M(r,"minItems",e.exactLength.value,e.exactLength.message,t),M(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case R.kY.ZodUnion:case R.kY.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return H(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in W&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=W[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return H(e,t)}(e,r);case R.kY.ZodIntersection:return function(e,t){let r=[ee(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),ee(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),a="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,n=[];return r.forEach(e=>{if(L(e))n.push(...e.allOf),void 0===e.unevaluatedProperties&&(a=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...a}=e;t=a}else a=void 0;n.push(t)}}),n.length?{allOf:n,...a}:void 0}(e,r);case R.kY.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,r)=>ee(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:ee(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,r)=>ee(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,r);case R.kY.ZodRecord:return V(e,r);case R.kY.ZodLiteral:return function(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case R.kY.ZodEnum:return{type:"string",enum:Array.from(e.values)};case R.kY.ZodNativeEnum:return function(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),a=Array.from(new Set(r.map(e=>typeof e)));return{type:1===a.length?"string"===a[0]?"string":"number":["string","number"],enum:r}}(e);case R.kY.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:W[e.innerType._def.typeName],nullable:!0}:{type:[W[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=ee(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let r=ee(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case R.kY.ZodOptional:return K(e,r);case R.kY.ZodMap:return function(e,t){return"record"===t.mapStrategy?V(e,t):{type:"array",maxItems:125,items:{type:"array",items:[ee(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},ee(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,r);case R.kY.ZodSet:return function(e,t){let r={type:"array",uniqueItems:!0,items:ee(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&M(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&M(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case R.kY.ZodLazy:return()=>e.getter()._def;case R.kY.ZodPromise:return ee(e.type._def,r);case R.kY.ZodNaN:case R.kY.ZodNever:return{not:{}};case R.kY.ZodEffects:return function(e,t){return"input"===t.effectStrategy?ee(e.schema._def,t):{}}(e,r);case R.kY.ZodAny:case R.kY.ZodUnknown:return{};case R.kY.ZodDefault:return function(e,t){return{...ee(e.innerType._def,t),default:e.defaultValue()}}(e,r);case R.kY.ZodBranded:return z(e,r);case R.kY.ZodReadonly:return X(e,r);case R.kY.ZodCatch:return D(e,r);case R.kY.ZodPipeline:return G(e,r);case R.kY.ZodFunction:case R.kY.ZodVoid:case R.kY.ZodSymbol:default:return}};function ee(e,t,r=!1){let a=t.seen.get(e);if(t.override){let n=t.override?.(e,t,a,r);if(n!==N)return n}if(a&&!r){let e=et(a,t);if(void 0!==e)return e}let n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);let s=Q(e,e.typeName,t),o="function"==typeof s?ee(s(),t):s;if(o&&ea(e,t,o),t.postProcess){let r=t.postProcess(o,e,t);return n.jsonSchema=o,r}return n.jsonSchema=o,o}let et=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:er(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},er=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},ea=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),en=(e,t)=>{let r=O(t),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,a])=>({...e,[t]:ee(a._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??{}}),{}):void 0,n="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,s=ee(e._def,void 0===n?r:{...r,currentPath:[...r.basePath,r.definitionPath,n]},!1)??{},o="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==o&&(s.title=o);let i=void 0===n?a?{...s,[r.definitionPath]:a}:s:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,n].join("/"),[r.definitionPath]:{...a,[n]:s}};return"jsonSchema7"===r.target?i.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===r.target||"openAi"===r.target)&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===r.target&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};var es={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},eo={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},ei={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},el={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},eu={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},ec=[es,eo,ei,el,eu],ep={[es.code]:es,[eo.code]:eo,[ei.code]:ei,[el.code]:el,[eu.code]:eu};es.name,es.code,eo.name,eo.code,ei.name,ei.code,el.name,el.code,eu.name,eu.code;var ed=ec.map(e=>e.code);function em(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=(0,A.N8)({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=(0,A.N8)({text:function(e){let t=["ROOT"],r=-1,a=null;function n(e,n,s){switch(e){case'"':r=n,t.pop(),t.push(s),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=n,a=n,t.pop(),t.push(s),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=n,t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"{":r=n,t.pop(),t.push(s),t.push("INSIDE_OBJECT_START");break;case"[":r=n,t.pop(),t.push(s),t.push("INSIDE_ARRAY_START")}}function s(e,a){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=a,t.pop()}}function o(e,a){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=a,t.pop()}}for(let i=0;i<e.length;i++){let l=e[i];switch(t[t.length-1]){case"ROOT":n(l,i,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=i,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":n(l,i,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":s(l,i);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),r=i;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=i}break;case"INSIDE_ARRAY_START":"]"===l?(r=i,t.pop()):(r=i,n(l,i,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=i,t.pop();break;default:r=i}break;case"INSIDE_ARRAY_AFTER_COMMA":n(l,i,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=i;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=i;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&o(l,i),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&s(l,i);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&s(l,i);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&o(l,i);break;default:t.pop()}break;case"INSIDE_LITERAL":{let n=e.substring(a,i+1);"false".startsWith(n)||"true".startsWith(n)||"null".startsWith(n)?r=i:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?s(l,i):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&o(l,i))}}}let i=e.slice(0,r+1);for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":i+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":i+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":i+="]";break;case"INSIDE_LITERAL":{let t=e.substring(a,e.length);"true".startsWith(t)?i+="true".slice(t.length):"false".startsWith(t)?i+="false".slice(t.length):"null".startsWith(t)&&(i+="null".slice(t.length))}}return i}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}var eh=[{code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},{code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},{code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},{code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},{code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},{code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},{code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},{code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},{code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},{code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},{code:"f",name:"start_step",parse:e=>{if(null==e||"object"!=typeof e||!("messageId"in e)||"string"!=typeof e.messageId)throw Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},{code:"g",name:"reasoning",parse:e=>{if("string"!=typeof e)throw Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},{code:"h",name:"source",parse:e=>{if(null==e||"object"!=typeof e)throw Error('"source" parts expect a Source object.');return{type:"source",value:e}}},{code:"i",name:"redacted_reasoning",parse:e=>{if(null==e||"object"!=typeof e||!("data"in e)||"string"!=typeof e.data)throw Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},{code:"j",name:"reasoning_signature",parse:e=>{if(null==e||"object"!=typeof e||!("signature"in e)||"string"!=typeof e.signature)throw Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}}],ef=Object.fromEntries(eh.map(e=>[e.code,e]));Object.fromEntries(eh.map(e=>[e.name,e.code]));var eg=eh.map(e=>e.code),ey=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let r=e.slice(0,t);if(!eg.includes(r))throw Error(`Failed to parse stream string. Invalid code ${r}.`);let a=JSON.parse(e.slice(t+1));return ef[r].parse(a)};function ev(e,t){let r=eh.find(t=>t.name===e);if(!r)throw Error(`Invalid stream part type: ${e}`);return`${r.code}:${JSON.stringify(t)}
`}async function eb({stream:e,onTextPart:t,onReasoningPart:r,onReasoningSignaturePart:a,onRedactedReasoningPart:n,onSourcePart:s,onDataPart:o,onErrorPart:i,onToolCallStreamingStartPart:l,onToolCallDeltaPart:u,onToolCallPart:c,onToolResultPart:p,onMessageAnnotationsPart:d,onFinishMessagePart:m,onFinishStepPart:h,onStartStepPart:f}){let g=e.getReader(),y=new TextDecoder,v=[],b=0;for(;;){let{value:e}=await g.read();if(e&&(v.push(e),b+=e.length,10!==e[e.length-1]))continue;if(0===v.length)break;let w=function(e,t){let r=new Uint8Array(t),a=0;for(let t of e)r.set(t,a),a+=t.length;return e.length=0,r}(v,b);for(let{type:e,value:g}of(b=0,y.decode(w,{stream:!0}).split("\n").filter(e=>""!==e).map(ey)))switch(e){case"text":await (null==t?void 0:t(g));break;case"reasoning":await (null==r?void 0:r(g));break;case"reasoning_signature":await (null==a?void 0:a(g));break;case"redacted_reasoning":await (null==n?void 0:n(g));break;case"source":await (null==s?void 0:s(g));break;case"data":await (null==o?void 0:o(g));break;case"error":await (null==i?void 0:i(g));break;case"message_annotations":await (null==d?void 0:d(g));break;case"tool_call_streaming_start":await (null==l?void 0:l(g));break;case"tool_call_delta":await (null==u?void 0:u(g));break;case"tool_call":await (null==c?void 0:c(g));break;case"tool_result":await (null==p?void 0:p(g));break;case"finish_message":await (null==m?void 0:m(g));break;case"finish_step":await (null==h?void 0:h(g));break;case"start_step":await (null==f?void 0:f(g));break;default:throw Error(`Unknown stream part type: ${e}`)}}}async function ew({stream:e,onTextPart:t}){let r=e.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:e,value:a}=await r.read();if(e)break;await t(a)}}var ex=Symbol.for("vercel.ai.schema");function e_(e){return"object"==typeof e&&null!==e&&ex in e&&!0===e[ex]&&"jsonSchema"in e&&"validate"in e?e:function(e,{validate:t}={}){return{[ex]:!0,_type:void 0,[A.eu]:!0,jsonSchema:e,validate:t}}(en(e,{$refStrategy:"none",target:"jsonSchema7"}),{validate:t=>{let r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}var eT=Object.defineProperty,ek=(e,t)=>{for(var r in t)eT(e,r,{get:t[r],enumerable:!0})};function eS(e,{contentType:t,dataStreamVersion:r}){let a=new Headers(null!=e?e:{});return a.has("Content-Type")||a.set("Content-Type",t),void 0!==r&&a.set("X-Vercel-AI-Data-Stream",r),a}function eA(e,{contentType:t,dataStreamVersion:r}){let a={};if(null!=e)for(let[t,r]of Object.entries(e))a[t]=r;return null==a["Content-Type"]&&(a["Content-Type"]=t),void 0!==r&&(a["X-Vercel-AI-Data-Stream"]=r),a}function eI({response:e,status:t,statusText:r,headers:a,stream:n}){e.writeHead(null!=t?t:200,r,a);let s=n.getReader();(async()=>{try{for(;;){let{done:t,value:r}=await s.read();if(t)break;e.write(r)}}catch(e){throw e}finally{e.end()}})()}var eE="AI_InvalidArgumentError",eR=`vercel.ai.error.${eE}`,eN=Symbol.for(eR),eC=class extends S.bD{constructor({parameter:e,value:t,message:r}){super({name:eE,message:`Invalid argument for parameter ${e}: ${r}`}),this[n]=!0,this.parameter=e,this.value=t}static isInstance(e){return S.bD.hasMarker(e,eR)}};n=eN;var eP="AI_RetryError",eO=`vercel.ai.error.${eP}`,ej=Symbol.for(eO),eM=class extends S.bD{constructor({message:e,reason:t,errors:r}){super({name:eP,message:e}),this[s]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return S.bD.hasMarker(e,eO)}};s=ej;var ez=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async a=>eD(a,{maxRetries:e,delayInMs:t,backoffFactor:r});async function eD(e,{maxRetries:t,delayInMs:r,backoffFactor:a},n=[]){try{return await e()}catch(l){if((0,A.zf)(l)||0===t)throw l;let s=(0,A.u1)(l),o=[...n,l],i=o.length;if(i>t)throw new eM({message:`Failed after ${i} attempts. Last error: ${s}`,reason:"maxRetriesExceeded",errors:o});if(l instanceof Error&&S.hL.isInstance(l)&&!0===l.isRetryable&&i<=t)return await (0,A.cb)(r),eD(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a},o);if(1===i)throw l;throw new eM({message:`Failed after ${i} attempts with non-retryable error: '${s}'`,reason:"errorNotRetryable",errors:o})}}function e$({maxRetries:e}){if(null!=e){if(!Number.isInteger(e))throw new eC({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new eC({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let t=null!=e?e:2;return{maxRetries:t,retry:ez({maxRetries:t})}}function eL({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}function eq({model:e,settings:t,telemetry:r,headers:a}){var n;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,r])=>(e[`ai.settings.${t}`]=r,e),{}),...Object.entries(null!=(n=null==r?void 0:r.metadata)?n:{}).reduce((e,[t,r])=>(e[`ai.telemetry.metadata.${t}`]=r,e),{}),...Object.entries(null!=a?a:{}).reduce((e,[t,r])=>(void 0!==r&&(e[`ai.request.headers.${t}`]=r),e),{})}}var eU={startSpan:()=>eF,startActiveSpan:(e,t,r,a)=>"function"==typeof t?t(eF):"function"==typeof r?r(eF):"function"==typeof a?a(eF):void 0},eF={spanContext:()=>eY,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},eY={traceId:"",spanId:"",traceFlags:0};function eZ({isEnabled:e=!1,tracer:t}={}){return e?t||I.u.getTracer("ai"):eU}function eB({name:e,tracer:t,attributes:r,fn:a,endWhenDone:n=!0}){return t.startActiveSpan(e,{attributes:r},async e=>{try{let t=await a(e);return n&&e.end(),t}catch(t){try{t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:E.s.ERROR,message:t.message})):e.setStatus({code:E.s.ERROR})}finally{e.end()}throw t}})}function eJ({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[r,a])=>{if(void 0===a)return t;if("object"==typeof a&&"input"in a&&"function"==typeof a.input){if((null==e?void 0:e.recordInputs)===!1)return t;let n=a.input();return void 0===n?t:{...t,[r]:n}}if("object"==typeof a&&"output"in a&&"function"==typeof a.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let n=a.output();return void 0===n?t:{...t,[r]:n}}return{...t,[r]:a}},{})}var eV="AI_NoImageGeneratedError",eW=`vercel.ai.error.${eV}`,eH=Symbol.for(eW);S.bD,o=eH;var eK="AI_NoObjectGeneratedError",eG=`vercel.ai.error.${eK}`,eX=Symbol.for(eG),eQ=class extends S.bD{constructor({message:e="No object generated.",cause:t,text:r,response:a,usage:n}){super({name:eK,message:e,cause:t}),this[i]=!0,this.text=r,this.response=a,this.usage=n}static isInstance(e){return S.bD.hasMarker(e,eG)}};i=eX;var e0="AI_DownloadError",e1=`vercel.ai.error.${e0}`,e2=Symbol.for(e1),e4=class extends S.bD{constructor({url:e,statusCode:t,statusText:r,cause:a,message:n=null==a?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`}){super({name:e0,message:n,cause:a}),this[l]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return S.bD.hasMarker(e,e1)}};async function e9({url:e,fetchImplementation:t=fetch}){var r;let a=e.toString();try{let e=await t(a);if(!e.ok)throw new e4({url:a,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mimeType:null!=(r=e.headers.get("content-type"))?r:void 0}}catch(e){if(e4.isInstance(e))throw e;throw new e4({url:a,cause:e})}}l=e2;var e3=[{mimeType:"image/gif",bytes:[71,73,70]},{mimeType:"image/png",bytes:[137,80,78,71]},{mimeType:"image/jpeg",bytes:[255,216]},{mimeType:"image/webp",bytes:[82,73,70,70]}],e8="AI_InvalidDataContentError",e5=`vercel.ai.error.${e8}`,e6=Symbol.for(e5),e7=class extends S.bD{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:e8,message:r,cause:t}),this[u]=!0,this.content=e}static isInstance(e){return S.bD.hasMarker(e,e5)}};u=e6;var te=R.z.union([R.z.string(),R.z.instanceof(Uint8Array),R.z.instanceof(ArrayBuffer),R.z.custom(e=>{var t,r;return null!=(r=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&r},{message:"Must be a Buffer"})]);function tt(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)try{return(0,A.Z9)(e)}catch(t){throw new e7({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new e7({content:e})}var tr="AI_InvalidMessageRoleError",ta=`vercel.ai.error.${tr}`,tn=Symbol.for(ta),ts=class extends S.bD{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:tr,message:t}),this[c]=!0,this.role=e}static isInstance(e){return S.bD.hasMarker(e,ta)}};async function to({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:r=()=>!1,downloadImplementation:a=e9}){let n=await ti(e.messages,a,t,r);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function(e,t){var r,a,n,s,o,i;let l=e.role;switch(l){case"system":return{role:"system",content:e.content,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerMetadata:null!=(a=e.providerOptions)?a:e.experimental_providerMetadata};return{role:"user",content:e.content.map(e=>(function(e,t){var r,a,n,s,o;let i,l,u;if("text"===e.type)return{type:"text",text:e.text,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};let c=e.mimeType,p=e.type;switch(p){case"image":i=e.image;break;case"file":i=e.data;break;default:throw Error(`Unsupported part type: ${p}`)}try{l="string"==typeof i?new URL(i):i}catch(e){l=i}if(l instanceof URL){if("data:"===l.protocol){let{mimeType:e,base64Content:t}=function(e){try{let[t,r]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch(e){return{mimeType:void 0,base64Content:void 0}}}(l.toString());if(null==e||null==t)throw Error(`Invalid data URL format in part ${p}`);c=e,u=tt(t)}else{let e=t[l.toString()];e?(u=e.data,null!=c||(c=e.mimeType)):u=l}}else u=tt(l);switch(p){case"image":return u instanceof Uint8Array&&(c=null!=(a=function(e){for(let{bytes:t,mimeType:r}of e3)if(e.length>=t.length&&t.every((t,r)=>e[r]===t))return r}(u))?a:c),{type:"image",image:u,mimeType:c,providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata};case"file":if(null==c)throw Error("Mime type is missing for file part");return{type:"file",data:u instanceof Uint8Array?"string"==typeof(o=u)?o:o instanceof ArrayBuffer?(0,A.n_)(new Uint8Array(o)):(0,A.n_)(o):u,filename:e.filename,mimeType:c,providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text).map(e=>{let{experimental_providerMetadata:t,providerOptions:r,...a}=e;return{...a,providerMetadata:null!=r?r:t}}),providerMetadata:null!=(o=e.providerOptions)?o:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(e=>{var t;return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result,content:e.experimental_content,isError:e.isError,providerMetadata:null!=(t=e.providerOptions)?t:e.experimental_providerMetadata}}),providerMetadata:null!=(i=e.providerOptions)?i:e.experimental_providerMetadata};default:throw new ts({role:l})}})(e,n))]}async function ti(e,t,r,a){let n=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).filter(e=>"image"!==e.type||!0!==r).map(e=>"image"===e.type?e.image:e.data).map(e=>"string"==typeof e&&(e.startsWith("http:")||e.startsWith("https:"))?new URL(e):e).filter(e=>e instanceof URL).filter(e=>!a(e));return Object.fromEntries((await Promise.all(n.map(async e=>({url:e,data:await t({url:e})})))).map(({url:e,data:t})=>[e.toString(),t]))}function tl({maxTokens:e,temperature:t,topP:r,topK:a,presencePenalty:n,frequencyPenalty:s,stopSequences:o,seed:i}){if(null!=e){if(!Number.isInteger(e))throw new eC({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new eC({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new eC({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=r&&"number"!=typeof r)throw new eC({parameter:"topP",value:r,message:"topP must be a number"});if(null!=a&&"number"!=typeof a)throw new eC({parameter:"topK",value:a,message:"topK must be a number"});if(null!=n&&"number"!=typeof n)throw new eC({parameter:"presencePenalty",value:n,message:"presencePenalty must be a number"});if(null!=s&&"number"!=typeof s)throw new eC({parameter:"frequencyPenalty",value:s,message:"frequencyPenalty must be a number"});if(null!=i&&!Number.isInteger(i))throw new eC({parameter:"seed",value:i,message:"seed must be an integer"});return{maxTokens:e,temperature:null!=t?t:0,topP:r,topK:a,presencePenalty:n,frequencyPenalty:s,stopSequences:null!=o&&o.length>0?o:void 0,seed:i}}c=tn;var tu="AI_MessageConversionError",tc=`vercel.ai.error.${tu}`,tp=Symbol.for(tc),td=class extends S.bD{constructor({originalMessage:e,message:t}){super({name:tu,message:t}),this[p]=!0,this.originalMessage=e}static isInstance(e){return S.bD.hasMarker(e,tc)}};function tm(e,t){var r,a;let n=null!=(r=null==t?void 0:t.tools)?r:{},s=[];for(let t=0;t<e.length;t++){let r=e[t],o=t===e.length-1,{role:i,content:l,experimental_attachments:u}=r;switch(i){case"system":s.push({role:"system",content:l});break;case"user":s.push({role:"user",content:u?[{type:"text",text:l},...function(e){var t,r,a;let n=[];for(let s of e){let e;try{e=new URL(s.url)}catch(e){throw Error(`Invalid URL: ${s.url}`)}switch(e.protocol){case"http:":case"https:":if(null==(t=s.contentType)?void 0:t.startsWith("image/"))n.push({type:"image",image:e});else{if(!s.contentType)throw Error("If the attachment is not an image, it must specify a content type");n.push({type:"file",data:e,mimeType:s.contentType})}break;case"data:":{let e,t,o;try{[e,t]=s.url.split(","),o=e.split(";")[0].split(":")[1]}catch(e){throw Error(`Error processing data URL: ${s.url}`)}if(null==o||null==t)throw Error(`Invalid data URL format: ${s.url}`);if(null==(r=s.contentType)?void 0:r.startsWith("image/"))n.push({type:"image",image:tt(t)});else if(null==(a=s.contentType)?void 0:a.startsWith("text/"))n.push({type:"text",text:function(e){try{return new TextDecoder().decode(e)}catch(e){throw Error("Error decoding Uint8Array to text")}}(tt(t))});else{if(!s.contentType)throw Error("If the attachment is not an image or text, it must specify a content type");n.push({type:"file",data:t,mimeType:s.contentType})}break}default:throw Error(`Unsupported URL protocol: ${e.protocol}`)}}return n}(u)]:l});break;case"assistant":{if(null!=r.parts){let e=function(){let e=[];for(let t of i)switch(t.type){case"text":e.push({type:"text",text:t.text});break;case"reasoning":for(let r of t.details)switch(r.type){case"text":e.push({type:"reasoning",text:r.text,signature:r.signature});break;case"redacted":e.push({type:"redacted-reasoning",data:r.data})}break;case"tool-invocation":e.push({type:"tool-call",toolCallId:t.toolInvocation.toolCallId,toolName:t.toolInvocation.toolName,args:t.toolInvocation.args});break;default:throw Error(`Unsupported part: ${t}`)}s.push({role:"assistant",content:e});let a=i.filter(e=>"tool-invocation"===e.type).map(e=>e.toolInvocation);a.length>0&&s.push({role:"tool",content:a.map(e=>{if(!("result"in e))throw new td({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:a,result:s}=e,o=n[a];return(null==o?void 0:o.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:a,result:o.experimental_toToolResultContent(s),experimental_content:o.experimental_toToolResultContent(s)}:{type:"tool-result",toolCallId:t,toolName:a,result:s}})}),i=[],o=!1,t++},t=0,o=!1,i=[];for(let n of r.parts)switch(n.type){case"reasoning":i.push(n);break;case"text":o&&e(),i.push(n);break;case"tool-invocation":(null!=(a=n.toolInvocation.step)?a:0)!==t&&e(),i.push(n),o=!0}e();break}let e=r.toolInvocations;if(null==e||0===e.length){s.push({role:"assistant",content:l});break}let t=e.reduce((e,t)=>{var r;return Math.max(e,null!=(r=t.step)?r:0)},0);for(let a=0;a<=t;a++){let t=e.filter(e=>{var t;return(null!=(t=e.step)?t:0)===a});0!==t.length&&(s.push({role:"assistant",content:[...o&&l&&0===a?[{type:"text",text:l}]:[],...t.map(({toolCallId:e,toolName:t,args:r})=>({type:"tool-call",toolCallId:e,toolName:t,args:r}))]}),s.push({role:"tool",content:t.map(e=>{if(!("result"in e))throw new td({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:a,result:s}=e,o=n[a];return(null==o?void 0:o.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:a,result:o.experimental_toToolResultContent(s),experimental_content:o.experimental_toToolResultContent(s)}:{type:"tool-result",toolCallId:t,toolName:a,result:s}})}))}l&&!o&&s.push({role:"assistant",content:l});break}case"data":break;default:throw new td({originalMessage:r,message:`Unsupported role: ${i}`})}}return s}function th(e){return"object"==typeof e&&null!==e&&("function"===e.role||"data"===e.role||"toolInvocations"in e||"experimental_attachments"in e)?"has-ui-specific-parts":"object"==typeof e&&null!==e&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":"object"==typeof e&&null!==e&&"role"in e&&"content"in e&&"string"==typeof e.content&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}p=tp;var tf=R.z.lazy(()=>R.z.union([R.z.null(),R.z.string(),R.z.number(),R.z.boolean(),R.z.record(R.z.string(),tf),R.z.array(tf)])),tg=R.z.record(R.z.string(),R.z.record(R.z.string(),tf)),ty=R.z.array(R.z.union([R.z.object({type:R.z.literal("text"),text:R.z.string()}),R.z.object({type:R.z.literal("image"),data:R.z.string(),mimeType:R.z.string().optional()})])),tv=R.z.object({type:R.z.literal("text"),text:R.z.string(),providerOptions:tg.optional(),experimental_providerMetadata:tg.optional()}),tb=R.z.object({type:R.z.literal("image"),image:R.z.union([te,R.z.instanceof(URL)]),mimeType:R.z.string().optional(),providerOptions:tg.optional(),experimental_providerMetadata:tg.optional()}),tw=R.z.object({type:R.z.literal("file"),data:R.z.union([te,R.z.instanceof(URL)]),filename:R.z.string().optional(),mimeType:R.z.string(),providerOptions:tg.optional(),experimental_providerMetadata:tg.optional()}),tx=R.z.object({type:R.z.literal("reasoning"),text:R.z.string(),providerOptions:tg.optional(),experimental_providerMetadata:tg.optional()}),t_=R.z.object({type:R.z.literal("redacted-reasoning"),data:R.z.string(),providerOptions:tg.optional(),experimental_providerMetadata:tg.optional()}),tT=R.z.object({type:R.z.literal("tool-call"),toolCallId:R.z.string(),toolName:R.z.string(),args:R.z.unknown(),providerOptions:tg.optional(),experimental_providerMetadata:tg.optional()}),tk=R.z.object({type:R.z.literal("tool-result"),toolCallId:R.z.string(),toolName:R.z.string(),result:R.z.unknown(),content:ty.optional(),isError:R.z.boolean().optional(),providerOptions:tg.optional(),experimental_providerMetadata:tg.optional()}),tS=R.z.object({role:R.z.literal("system"),content:R.z.string(),providerOptions:tg.optional(),experimental_providerMetadata:tg.optional()}),tA=R.z.object({role:R.z.literal("user"),content:R.z.union([R.z.string(),R.z.array(R.z.union([tv,tb,tw]))]),providerOptions:tg.optional(),experimental_providerMetadata:tg.optional()}),tI=R.z.object({role:R.z.literal("assistant"),content:R.z.union([R.z.string(),R.z.array(R.z.union([tv,tx,t_,tT]))]),providerOptions:tg.optional(),experimental_providerMetadata:tg.optional()}),tE=R.z.object({role:R.z.literal("tool"),content:R.z.array(tk),providerOptions:tg.optional(),experimental_providerMetadata:tg.optional()}),tR=R.z.union([tS,tA,tI,tE]);function tN({prompt:e,tools:t}){if(null==e.prompt&&null==e.messages)throw new S.M3({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new S.M3({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new S.M3({prompt:e,message:"system must be a string"});if(null!=e.prompt){if("string"!=typeof e.prompt)throw new S.M3({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(null!=e.messages){let r=function(e){if(!Array.isArray(e))return"other";if(0===e.length)return"messages";let t=e.map(th);return t.some(e=>"has-ui-specific-parts"===e)?"ui-messages":t.every(e=>"has-core-specific-parts"===e||"message"===e)?"messages":"other"}(e.messages);if("other"===r)throw new S.M3({prompt:e,message:"messages must be an array of CoreMessage or UIMessage"});let a="ui-messages"===r?tm(e.messages,{tools:t}):e.messages,n=(0,A.ZZ)({value:a,schema:R.z.array(tR)});if(!n.success)throw new S.M3({prompt:e,message:"messages must be an array of CoreMessage or UIMessage",cause:n.error});return{type:"messages",messages:a,system:e.system}}throw Error("unreachable")}function tC({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function tP(e,t){return{promptTokens:e.promptTokens+t.promptTokens,completionTokens:e.completionTokens+t.completionTokens,totalTokens:e.totalTokens+t.totalTokens}}function tO({prompt:e,schema:t,schemaPrefix:r=null!=t?"JSON schema:":void 0,schemaSuffix:a=null!=t?"You MUST answer with a JSON object that matches the JSON schema above.":"You MUST answer with JSON."}){return[null!=e&&e.length>0?e:void 0,null!=e&&e.length>0?"":void 0,r,null!=t?JSON.stringify(t):void 0,a].filter(e=>null!=e).join("\n")}function tj(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{let e=t.getReader();return{async next(){let{done:t,value:r}=await e.read();return t?{done:!0,value:void 0}:{done:!1,value:r}}}},t}var tM={type:"no-schema",jsonSchema:void 0,validatePartialResult:({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:(e,t)=>void 0===e?{success:!1,error:new eQ({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage})}:{success:!0,value:e},createElementStream(){throw new S.b8({functionality:"element streams in no-schema mode"})}},tz=e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult:({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:t=>safeValidateTypes2({value:t,schema:e}),createElementStream(){throw new UnsupportedFunctionalityError({functionality:"element streams in object mode"})}}),tD=e=>{let{$schema:t,...r}=e.jsonSchema;return{type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:r}},required:["elements"],additionalProperties:!1},validatePartialResult({value:t,latestObject:r,isFirstDelta:a,isFinalDelta:n}){var s;if(!isJSONObject(t)||!isJSONArray(t.elements))return{success:!1,error:new TypeValidationError({value:t,cause:"value must be an object that contains an array of elements"})};let o=t.elements,i=[];for(let t=0;t<o.length;t++){let r=safeValidateTypes2({value:o[t],schema:e});if(t!==o.length-1||n){if(!r.success)return r;i.push(r.value)}}let l=null!=(s=null==r?void 0:r.length)?s:0,u="";return a&&(u+="["),l>0&&(u+=","),u+=i.slice(l).map(e=>JSON.stringify(e)).join(","),n&&(u+="]"),{success:!0,value:{partial:i,textDelta:u}}},validateFinalResult(t){if(!isJSONObject(t)||!isJSONArray(t.elements))return{success:!1,error:new TypeValidationError({value:t,cause:"value must be an object that contains an array of elements"})};let r=t.elements;for(let t of r){let r=safeValidateTypes2({value:t,schema:e});if(!r.success)return r}return{success:!0,value:r}},createElementStream(e){let t=0;return tj(e.pipeThrough(new TransformStream({transform(e,r){switch(e.type){case"object":{let a=e.object;for(;t<a.length;t++)r.enqueue(a[t]);break}case"text-delta":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${e}`)}}})))}}},t$=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},validateFinalResult(t){if(!isJSONObject(t)||"string"!=typeof t.result)return{success:!1,error:new TypeValidationError({value:t,cause:'value must be an object that contains a string in the "result" property.'})};let r=t.result;return e.includes(r)?{success:!0,value:r}:{success:!1,error:new TypeValidationError({value:t,cause:"value must be a string in the enum"})}},validatePartialResult(){throw new UnsupportedFunctionalityError({functionality:"partial results in enum mode"})},createElementStream(){throw new UnsupportedFunctionalityError({functionality:"element streams in enum mode"})}});(0,A.hK)({prefix:"aiobj",size:24});var tL=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise||(this.promise=new Promise((e,t)=>{"resolved"===this.status.type?e(this.status.value):"rejected"===this.status.type&&t(this.status.error),this._resolve=e,this._reject=t})),this.promise}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&(null==(t=this._resolve)||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&(null==(t=this._reject)||t.call(this,e))}};function tq(){let e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}}function tU(){let e=[],t=null,r=!1,a=tq(),n=async()=>{if(r&&0===e.length){null==t||t.close();return}if(0===e.length)return a=tq(),await a.promise,n();try{let{value:a,done:s}=await e[0].read();s?(e.shift(),e.length>0?await n():r&&(null==t||t.close())):null==t||t.enqueue(a)}catch(a){null==t||t.error(a),e.shift(),r&&0===e.length&&(null==t||t.close())}};return{stream:new ReadableStream({start(e){t=e},pull:n,async cancel(){for(let t of e)await t.cancel();e=[],r=!0}}),addStream:t=>{if(r)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),a.resolve()},close:()=>{r=!0,a.resolve(),0===e.length&&(null==t||t.close())},terminate:()=>{r=!0,a.resolve(),e.forEach(e=>e.cancel()),e=[],null==t||t.close()}}}(0,A.hK)({prefix:"aiobj",size:24});var tF="AI_NoOutputSpecifiedError",tY=`vercel.ai.error.${tF}`,tZ=Symbol.for(tY),tB=class extends S.bD{constructor({message:e="No output specified."}={}){super({name:tF,message:e}),this[d]=!0}static isInstance(e){return S.bD.hasMarker(e,tY)}};d=tZ;var tJ="AI_ToolExecutionError",tV=`vercel.ai.error.${tJ}`,tW=Symbol.for(tV),tH=class extends S.bD{constructor({toolArgs:e,toolName:t,toolCallId:r,cause:a,message:n=`Error executing tool ${t}: ${(0,S.u1)(a)}`}){super({name:tJ,message:n,cause:a}),this[m]=!0,this.toolArgs=e,this.toolName=t,this.toolCallId=r}static isInstance(e){return S.bD.hasMarker(e,tV)}};function tK({tools:e,toolChoice:t,activeTools:r}){return null!=e&&Object.keys(e).length>0?{tools:(null!=r?Object.entries(e).filter(([e])=>r.includes(e)):Object.entries(e)).map(([e,t])=>{let r=t.type;switch(r){case void 0:case"function":return{type:"function",name:e,description:t.description,parameters:e_(t.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${r}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}m=tW;var tG=/^([\s\S]*?)(\s+)(\S*)$/;function tX(e){let t=e.match(tG);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}var tQ="AI_InvalidToolArgumentsError",t0=`vercel.ai.error.${tQ}`,t1=Symbol.for(t0),t2=class extends S.bD{constructor({toolArgs:e,toolName:t,cause:r,message:a=`Invalid arguments for tool ${t}: ${(0,S.u1)(r)}`}){super({name:tQ,message:a,cause:r}),this[h]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return S.bD.hasMarker(e,t0)}};h=t1;var t4="AI_NoSuchToolError",t9=`vercel.ai.error.${t4}`,t3=Symbol.for(t9),t8=class extends S.bD{constructor({toolName:e,availableTools:t,message:r=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:t4,message:r}),this[f]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return S.bD.hasMarker(e,t9)}};f=t3;var t5="AI_ToolCallRepairError",t6=`vercel.ai.error.${t5}`,t7=Symbol.for(t6),re=class extends S.bD{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${(0,S.u1)(e)}`}){super({name:t5,message:r,cause:e}),this[g]=!0,this.originalError=t}static isInstance(e){return S.bD.hasMarker(e,t6)}};async function rt({toolCall:e,tools:t,repairToolCall:r,system:a,messages:n}){if(null==t)throw new t8({toolName:e.toolName});try{return await rr({toolCall:e,tools:t})}catch(o){if(null==r||!(t8.isInstance(o)||t2.isInstance(o)))throw o;let s=null;try{s=await r({toolCall:e,tools:t,parameterSchema:({toolName:e})=>e_(t[e].parameters).jsonSchema,system:a,messages:n,error:o})}catch(e){throw new re({cause:e,originalError:o})}if(null==s)throw o;return await rr({toolCall:s,tools:t})}}async function rr({toolCall:e,tools:t}){let r=e.toolName,a=t[r];if(null==a)throw new t8({toolName:e.toolName,availableTools:Object.keys(t)});let n=e_(a.parameters),s=""===e.args.trim()?(0,A.ZZ)({value:{},schema:n}):(0,A.N8)({text:e.args,schema:n});if(!1===s.success)throw new t2({toolName:r,toolArgs:e.args,cause:s.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:s.value}}function ra(e){let t=e.filter(e=>"text"===e.type).map(e=>e.text).join("");return t.length>0?t:void 0}function rn({text:e="",reasoning:t,tools:r,toolCalls:a,toolResults:n,messageId:s,generateMessageId:o}){let i=[];return i.push({role:"assistant",content:[...t.map(e=>"text"===e.type?{...e,type:"reasoning"}:{...e,type:"redacted-reasoning"}),{type:"text",text:e},...a],id:s}),n.length>0&&i.push({role:"tool",id:o(),content:n.map(e=>{let t=r[e.toolName];return(null==t?void 0:t.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:t.experimental_toToolResultContent(e.result),experimental_content:t.experimental_toToolResultContent(e.result)}:{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result}})}),i}g=t7;var rs=(0,A.hK)({prefix:"aitxt",size:24}),ro=(0,A.hK)({prefix:"msg",size:24});async function ri({model:e,tools:t,toolChoice:r,system:a,prompt:n,messages:s,maxRetries:o,abortSignal:i,headers:l,maxSteps:u=1,experimental_generateMessageId:c=ro,experimental_output:p,experimental_continueSteps:d=!1,experimental_telemetry:m,experimental_providerMetadata:h,providerOptions:f=h,experimental_activeTools:g,experimental_repairToolCall:y,_internal:{generateId:v=rs,currentDate:b=()=>new Date}={},onStepFinish:w,...x}){var _;if(u<1)throw new eC({parameter:"maxSteps",value:u,message:"maxSteps must be at least 1"});let{maxRetries:T,retry:k}=e$({maxRetries:o}),S=eq({model:e,telemetry:m,headers:l,settings:{...x,maxRetries:T}}),A=tN({prompt:{system:null!=(_=null==p?void 0:p.injectIntoSystemPrompt({system:a,model:e}))?_:a,prompt:n,messages:s},tools:t}),I=eZ(m);return eB({name:"ai.generateText",attributes:eJ({telemetry:m,attributes:{...eL({operationId:"ai.generateText",telemetry:m}),...S,"ai.prompt":{input:()=>JSON.stringify({system:a,prompt:n,messages:s})},"ai.settings.maxSteps":u}}),tracer:I,fn:async n=>{var s,o,h,_,T,E,R,N,C,P,O;let j;let M={type:"regular",...tK({tools:t,toolChoice:r,activeTools:g})},z=tl(x),D=[],$=[],L=[],q=0,U=[],F="",Y=[],Z=[],B={completionTokens:0,promptTokens:0,totalTokens:0},J="initial";do{let r=0===q?A.type:"messages",n=[...A.messages,...U],g=await to({prompt:{type:r,system:A.system,messages:n},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(s=e.supportsUrl)?void 0:s.bind(e)});j=await k(()=>eB({name:"ai.generateText.doGenerate",attributes:eJ({telemetry:m,attributes:{...eL({operationId:"ai.generateText.doGenerate",telemetry:m}),...S,"ai.prompt.format":{input:()=>r},"ai.prompt.messages":{input:()=>JSON.stringify(g)},"ai.prompt.tools":{input:()=>{var e;return null==(e=M.tools)?void 0:e.map(e=>JSON.stringify(e))}},"ai.prompt.toolChoice":{input:()=>null!=M.toolChoice?JSON.stringify(M.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":x.frequencyPenalty,"gen_ai.request.max_tokens":x.maxTokens,"gen_ai.request.presence_penalty":x.presencePenalty,"gen_ai.request.stop_sequences":x.stopSequences,"gen_ai.request.temperature":x.temperature,"gen_ai.request.top_k":x.topK,"gen_ai.request.top_p":x.topP}}),tracer:I,fn:async t=>{var a,n,s,o,u,c;let d=await e.doGenerate({mode:M,...z,inputFormat:r,responseFormat:null==p?void 0:p.responseFormat({model:e}),prompt:g,providerMetadata:f,abortSignal:i,headers:l}),h={id:null!=(n=null==(a=d.response)?void 0:a.id)?n:v(),timestamp:null!=(o=null==(s=d.response)?void 0:s.timestamp)?o:b(),modelId:null!=(c=null==(u=d.response)?void 0:u.modelId)?c:e.modelId};return t.setAttributes(eJ({telemetry:m,attributes:{"ai.response.finishReason":d.finishReason,"ai.response.text":{output:()=>d.text},"ai.response.toolCalls":{output:()=>JSON.stringify(d.toolCalls)},"ai.response.id":h.id,"ai.response.model":h.modelId,"ai.response.timestamp":h.timestamp.toISOString(),"ai.usage.promptTokens":d.usage.promptTokens,"ai.usage.completionTokens":d.usage.completionTokens,"gen_ai.response.finish_reasons":[d.finishReason],"gen_ai.response.id":h.id,"gen_ai.response.model":h.modelId,"gen_ai.usage.input_tokens":d.usage.promptTokens,"gen_ai.usage.output_tokens":d.usage.completionTokens}})),{...d,response:h}}})),D=await Promise.all((null!=(o=j.toolCalls)?o:[]).map(e=>rt({toolCall:e,tools:t,repairToolCall:y,system:a,messages:n}))),$=null==t?[]:await rl({toolCalls:D,tools:t,tracer:I,telemetry:m,messages:n,abortSignal:i});let C=tC(j.usage);B=tP(B,C);let P="done";++q<u&&(d&&"length"===j.finishReason&&0===D.length?P="continue":D.length>0&&$.length===D.length&&(P="tool-result"));let O=null!=(h=j.text)?h:"",V="continue"===J&&F.trimEnd()!==F?O.trimStart():O,W="continue"===P?function(e){let t=tX(e);return t?t.prefix+t.whitespace:e}(V):V;if(F="continue"===P||"continue"===J?F+W:W,L=rc(j.reasoning),Y.push(...null!=(_=j.sources)?_:[]),"continue"===J){let e=U[U.length-1];"string"==typeof e.content?e.content+=W:e.content.push({text:W,type:"text"})}else U.push(...rn({text:F,reasoning:rc(j.reasoning),tools:null!=t?t:{},toolCalls:D,toolResults:$,messageId:c(),generateMessageId:c}));let H={stepType:J,text:W,reasoning:ra(L),reasoningDetails:L,sources:null!=(T=j.sources)?T:[],toolCalls:D,toolResults:$,finishReason:j.finishReason,usage:C,warnings:j.warnings,logprobs:j.logprobs,request:null!=(E=j.request)?E:{},response:{...j.response,headers:null==(R=j.rawResponse)?void 0:R.headers,body:null==(N=j.rawResponse)?void 0:N.body,messages:structuredClone(U)},providerMetadata:j.providerMetadata,experimental_providerMetadata:j.providerMetadata,isContinued:"continue"===P};Z.push(H),await (null==w?void 0:w(H)),J=P}while("done"!==J);return n.setAttributes(eJ({telemetry:m,attributes:{"ai.response.finishReason":j.finishReason,"ai.response.text":{output:()=>j.text},"ai.response.toolCalls":{output:()=>JSON.stringify(j.toolCalls)},"ai.usage.promptTokens":j.usage.promptTokens,"ai.usage.completionTokens":j.usage.completionTokens}})),new ru({text:F,reasoning:ra(L),reasoningDetails:L,sources:Y,outputResolver:()=>{if(null==p)throw new tB;return p.parseOutput({text:F},{response:j.response,usage:B})},toolCalls:D,toolResults:$,finishReason:j.finishReason,usage:B,warnings:j.warnings,request:null!=(C=j.request)?C:{},response:{...j.response,headers:null==(P=j.rawResponse)?void 0:P.headers,body:null==(O=j.rawResponse)?void 0:O.body,messages:U},logprobs:j.logprobs,steps:Z,providerMetadata:j.providerMetadata})}})}async function rl({toolCalls:e,tools:t,tracer:r,telemetry:a,messages:n,abortSignal:s}){return(await Promise.all(e.map(async({toolCallId:e,toolName:o,args:i})=>{let l=t[o];if((null==l?void 0:l.execute)==null)return;let u=await eB({name:"ai.toolCall",attributes:eJ({telemetry:a,attributes:{...eL({operationId:"ai.toolCall",telemetry:a}),"ai.toolCall.name":o,"ai.toolCall.id":e,"ai.toolCall.args":{output:()=>JSON.stringify(i)}}}),tracer:r,fn:async t=>{try{let r=await l.execute(i,{toolCallId:e,messages:n,abortSignal:s});try{t.setAttributes(eJ({telemetry:a,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(r)}}}))}catch(e){}return r}catch(t){throw new tH({toolCallId:e,toolName:o,toolArgs:i,cause:t})}}});return{type:"tool-result",toolCallId:e,toolName:o,args:i,result:u}}))).filter(e=>null!=e)}var ru=class{constructor(e){this.text=e.text,this.reasoning=e.reasoning,this.reasoningDetails=e.reasoningDetails,this.toolCalls=e.toolCalls,this.toolResults=e.toolResults,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.request=e.request,this.response=e.response,this.steps=e.steps,this.experimental_providerMetadata=e.providerMetadata,this.providerMetadata=e.providerMetadata,this.logprobs=e.logprobs,this.outputResolver=e.outputResolver,this.sources=e.sources}get experimental_output(){return this.outputResolver()}};function rc(e){return null==e?[]:"string"==typeof e?[{type:"text",text:e}]:e}ek({},{object:()=>rb,text:()=>rv});var rp="AI_InvalidStreamPartError",rd=`vercel.ai.error.${rp}`,rm=Symbol.for(rd),rh=class extends S.bD{constructor({chunk:e,message:t}){super({name:rp,message:t}),this[y]=!0,this.chunk=e}static isInstance(e){return S.bD.hasMarker(e,rd)}};y=rm;var rf="vercel.ai.error.AI_MCPClientError",rg=Symbol.for(rf),ry=class extends S.bD{constructor({name:e="MCPClientError",message:t,cause:r}){super({name:e,message:t,cause:r}),this[v]=!0}static isInstance(e){return S.bD.hasMarker(e,rf)}};v=rg;var rv=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt:({system:e})=>e,parsePartial:({text:e})=>({partial:e}),parseOutput:({text:e})=>e}),rb=({schema:e})=>{let t=e_(e);return{type:"object",responseFormat:({model:e})=>({type:"json",schema:e.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt:({system:e,model:r})=>r.supportsStructuredOutputs?e:tO({prompt:e,schema:t.jsonSchema}),parsePartial({text:e}){let t=em(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},parseOutput({text:e},r){let a=(0,A.N8)({text:e});if(!a.success)throw new eQ({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:r.response,usage:r.usage});let n=(0,A.ZZ)({value:a.value,schema:t});if(!n.success)throw new eQ({message:"No object generated: response did not match schema.",cause:n.error,text:e,response:r.response,usage:r.usage});return n.value}}};function rw(e,t){let r,a;let n=e.getReader(),s=t.getReader(),o=!1,i=!1;async function l(e){try{null==r&&(r=n.read());let t=await r;r=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}async function u(e){try{null==a&&(a=s.read());let t=await a;a=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}return new ReadableStream({async pull(e){try{if(o){await u(e);return}if(i){await l(e);return}null==r&&(r=n.read()),null==a&&(a=s.read());let{result:t,reader:c}=await Promise.race([r.then(e=>({result:e,reader:n})),a.then(e=>({result:e,reader:s}))]);t.done||e.enqueue(t.value),c===n?(r=void 0,t.done&&(await u(e),o=!0)):(a=void 0,t.done&&(i=!0,await l(e)))}catch(t){e.error(t)}},cancel(){n.cancel(),s.cancel()}})}var rx=(0,A.hK)({prefix:"aitxt",size:24}),r_=(0,A.hK)({prefix:"msg",size:24}),rT=class{constructor({model:e,telemetry:t,headers:r,settings:a,maxRetries:n,abortSignal:s,system:o,prompt:i,messages:l,tools:u,toolChoice:c,toolCallStreaming:p,transforms:d,activeTools:m,repairToolCall:h,maxSteps:f,output:g,continueSteps:y,providerOptions:v,now:b,currentDate:w,generateId:x,generateMessageId:_,onChunk:T,onError:k,onFinish:I,onStepFinish:E}){var R;let N,C,P,O;if(this.warningsPromise=new tL,this.usagePromise=new tL,this.finishReasonPromise=new tL,this.providerMetadataPromise=new tL,this.textPromise=new tL,this.reasoningPromise=new tL,this.reasoningDetailsPromise=new tL,this.sourcesPromise=new tL,this.toolCallsPromise=new tL,this.toolResultsPromise=new tL,this.requestPromise=new tL,this.responsePromise=new tL,this.stepsPromise=new tL,f<1)throw new eC({parameter:"maxSteps",value:f,message:"maxSteps must be at least 1"});this.output=g;let j="",M="",z="",D=[],$=[],L=[],q={id:x(),timestamp:w(),modelId:e.modelId,messages:[]},U=[],F=[],Y="initial",Z=[],B=new TransformStream({async transform(e,t){t.enqueue(e);let{part:r}=e;if(("text-delta"===r.type||"reasoning"===r.type||"source"===r.type||"tool-call"===r.type||"tool-result"===r.type||"tool-call-streaming-start"===r.type||"tool-call-delta"===r.type)&&await (null==T?void 0:T({chunk:r})),"error"===r.type&&await (null==k?void 0:k({error:r.error})),"text-delta"===r.type&&(j+=r.textDelta,M+=r.textDelta,z+=r.textDelta),"reasoning"===r.type&&(null==C?(C={type:"text",text:r.textDelta},D.push(C)):C.text+=r.textDelta),"reasoning-signature"===r.type){if(null==C)throw new S.bD({name:"InvalidStreamPart",message:"reasoning-signature without reasoning"});C.signature=r.signature,C=void 0}if("redacted-reasoning"===r.type&&D.push({type:"redacted",data:r.data}),"source"===r.type&&(L.push(r.source),$.push(r.source)),"tool-call"===r.type&&U.push(r),"tool-result"===r.type&&F.push(r),"step-finish"===r.type){let e=rn({text:M,reasoning:D,tools:null!=u?u:{},toolCalls:U,toolResults:F,messageId:r.messageId,generateMessageId:_}),t=Z.length,a="done";t+1<f&&(y&&"length"===r.finishReason&&0===U.length?a="continue":U.length>0&&F.length===U.length&&(a="tool-result"));let n={stepType:Y,text:j,reasoning:ra(D),reasoningDetails:D,sources:$,toolCalls:U,toolResults:F,finishReason:r.finishReason,usage:r.usage,warnings:r.warnings,logprobs:r.logprobs,request:r.request,response:{...r.response,messages:[...q.messages,...e]},providerMetadata:r.experimental_providerMetadata,experimental_providerMetadata:r.experimental_providerMetadata,isContinued:r.isContinued};await (null==E?void 0:E(n)),Z.push(n),U=[],F=[],j="",$=[],D=[],C=void 0,"done"!==a&&(Y=a),"continue"!==a&&(q.messages.push(...e),M="")}"finish"===r.type&&(q.id=r.response.id,q.timestamp=r.response.timestamp,q.modelId=r.response.modelId,q.headers=r.response.headers,O=r.usage,P=r.finishReason)},async flush(e){var r;try{if(0===Z.length)return;let e=Z[Z.length-1];Q.warningsPromise.resolve(e.warnings),Q.requestPromise.resolve(e.request),Q.responsePromise.resolve(e.response),Q.toolCallsPromise.resolve(e.toolCalls),Q.toolResultsPromise.resolve(e.toolResults),Q.providerMetadataPromise.resolve(e.experimental_providerMetadata),Q.reasoningPromise.resolve(e.reasoning),Q.reasoningDetailsPromise.resolve(e.reasoningDetails);let a=null!=P?P:"unknown",n=null!=O?O:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN};Q.finishReasonPromise.resolve(a),Q.usagePromise.resolve(n),Q.textPromise.resolve(z),Q.sourcesPromise.resolve(L),Q.stepsPromise.resolve(Z),await (null==I?void 0:I({finishReason:a,logprobs:void 0,usage:n,text:z,reasoning:e.reasoning,reasoningDetails:e.reasoningDetails,sources:e.sources,toolCalls:e.toolCalls,toolResults:e.toolResults,request:null!=(r=e.request)?r:{},response:e.response,warnings:e.warnings,providerMetadata:e.providerMetadata,experimental_providerMetadata:e.experimental_providerMetadata,steps:Z})),N.setAttributes(eJ({telemetry:t,attributes:{"ai.response.finishReason":a,"ai.response.text":{output:()=>z},"ai.response.toolCalls":{output:()=>{var t;return(null==(t=e.toolCalls)?void 0:t.length)?JSON.stringify(e.toolCalls):void 0}},"ai.usage.promptTokens":n.promptTokens,"ai.usage.completionTokens":n.completionTokens}}))}catch(t){e.error(t)}finally{N.end()}}}),J=tU();this.addStream=J.addStream,this.closeStream=J.close;let V=J.stream;for(let e of d)V=V.pipeThrough(e({tools:u,stopStream(){J.terminate()}}));this.baseStream=V.pipeThrough(function(e){if(!e)return new TransformStream({transform(e,t){t.enqueue({part:e,partialOutput:void 0})}});let t="",r="",a="";function n({controller:e,partialOutput:t}){e.enqueue({part:{type:"text-delta",textDelta:r},partialOutput:t}),r=""}return new TransformStream({transform(s,o){if("step-finish"===s.type&&n({controller:o}),"text-delta"!==s.type){o.enqueue({part:s,partialOutput:void 0});return}t+=s.textDelta,r+=s.textDelta;let i=e.parsePartial({text:t});if(null!=i){let e=JSON.stringify(i.partial);e!==a&&(n({controller:o,partialOutput:i.partial}),a=e)}},flush(e){r.length>0&&n({controller:e})}})}(g)).pipeThrough(B);let{maxRetries:W,retry:H}=e$({maxRetries:n}),K=eZ(t),G=eq({model:e,telemetry:t,headers:r,settings:{...a,maxRetries:W}}),X=tN({prompt:{system:null!=(R=null==g?void 0:g.injectIntoSystemPrompt({system:o,model:e}))?R:o,prompt:i,messages:l},tools:u}),Q=this;eB({name:"ai.streamText",attributes:eJ({telemetry:t,attributes:{...eL({operationId:"ai.streamText",telemetry:t}),...G,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:i,messages:l})},"ai.settings.maxSteps":f}}),tracer:K,endWhenDone:!1,fn:async n=>{async function i({currentStep:n,responseMessages:l,usage:d,stepType:T,previousStepText:k,hasLeadingWhitespace:S,messageId:I}){var E;let R,N,C;let P=0===l.length?X.type:"messages",O=[...X.messages,...l],j=await to({prompt:{type:P,system:X.system,messages:O},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(E=e.supportsUrl)?void 0:E.bind(e)}),M={type:"regular",...tK({tools:u,toolChoice:c,activeTools:m})},{result:{stream:z,warnings:D,rawResponse:$,request:L},doStreamSpan:q,startTimestampMs:U}=await H(()=>eB({name:"ai.streamText.doStream",attributes:eJ({telemetry:t,attributes:{...eL({operationId:"ai.streamText.doStream",telemetry:t}),...G,"ai.prompt.format":{input:()=>P},"ai.prompt.messages":{input:()=>JSON.stringify(j)},"ai.prompt.tools":{input:()=>{var e;return null==(e=M.tools)?void 0:e.map(e=>JSON.stringify(e))}},"ai.prompt.toolChoice":{input:()=>null!=M.toolChoice?JSON.stringify(M.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":a.frequencyPenalty,"gen_ai.request.max_tokens":a.maxTokens,"gen_ai.request.presence_penalty":a.presencePenalty,"gen_ai.request.stop_sequences":a.stopSequences,"gen_ai.request.temperature":a.temperature,"gen_ai.request.top_k":a.topK,"gen_ai.request.top_p":a.topP}}),tracer:K,endWhenDone:!1,fn:async t=>({startTimestampMs:b(),doStreamSpan:t,result:await e.doStream({mode:M,...tl(a),inputFormat:P,responseFormat:null==g?void 0:g.responseFormat({model:e}),prompt:j,providerMetadata:v,abortSignal:s,headers:r})})})),F=function({tools:e,generatorStream:t,toolCallStreaming:r,tracer:a,telemetry:n,system:s,messages:o,abortSignal:i,repairToolCall:l}){let u,c=null,p=new ReadableStream({start(e){c=e}}),d={},m=new Set,h=!1;function f(){h&&0===m.size&&(null!=u&&c.enqueue(u),c.close())}let g=new TransformStream({async transform(t,p){let h=t.type;switch(h){case"text-delta":case"reasoning":case"reasoning-signature":case"redacted-reasoning":case"source":case"response-metadata":case"error":p.enqueue(t);break;case"tool-call-delta":r&&(d[t.toolCallId]||(p.enqueue({type:"tool-call-streaming-start",toolCallId:t.toolCallId,toolName:t.toolName}),d[t.toolCallId]=!0),p.enqueue({type:"tool-call-delta",toolCallId:t.toolCallId,toolName:t.toolName,argsTextDelta:t.argsTextDelta}));break;case"tool-call":try{let r=await rt({toolCall:t,tools:e,repairToolCall:l,system:s,messages:o});p.enqueue(r);let u=e[r.toolName];if(null!=u.execute){let e=(0,A.$C)();m.add(e),eB({name:"ai.toolCall",attributes:eJ({telemetry:n,attributes:{...eL({operationId:"ai.toolCall",telemetry:n}),"ai.toolCall.name":r.toolName,"ai.toolCall.id":r.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(r.args)}}}),tracer:a,fn:async t=>u.execute(r.args,{toolCallId:r.toolCallId,messages:o,abortSignal:i}).then(a=>{c.enqueue({...r,type:"tool-result",result:a}),m.delete(e),f();try{t.setAttributes(eJ({telemetry:n,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(a)}}}))}catch(e){}},t=>{c.enqueue({type:"error",error:new tH({toolCallId:r.toolCallId,toolName:r.toolName,toolArgs:r.args,cause:t})}),m.delete(e),f()})})}}catch(e){c.enqueue({type:"error",error:e})}break;case"finish":u={type:"finish",finishReason:t.finishReason,logprobs:t.logprobs,usage:tC(t.usage),experimental_providerMetadata:t.providerMetadata};break;default:throw Error(`Unhandled chunk type: ${h}`)}},flush(){h=!0,f()}});return new ReadableStream({start:async e=>Promise.all([t.pipeThrough(g).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),p.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])})}({tools:u,generatorStream:z,toolCallStreaming:p,tracer:K,telemetry:t,system:o,messages:O,repairToolCall:h,abortSignal:s}),Y=null!=L?L:{},Z=[],B=[],J=[],V="unknown",W={promptTokens:0,completionTokens:0,totalTokens:0},ee=!0,et="",er="continue"===T?k:"",ea={id:x(),timestamp:w(),modelId:e.modelId},en="",es=!1,eo=!0,ei=!1;async function el({controller:e,chunk:t}){e.enqueue(t),et+=t.textDelta,er+=t.textDelta,es=!0,ei=t.textDelta.trimEnd()!==t.textDelta}Q.addStream(F.pipeThrough(new TransformStream({async transform(e,t){var r,a,n;if(ee){let e=b()-U;ee=!1,q.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":e}),q.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:"step-start",messageId:I,request:Y,warnings:null!=D?D:[]})}if("text-delta"===e.type&&0===e.textDelta.length)return;let s=e.type;switch(s){case"text-delta":if(y){let r=eo&&S?e.textDelta.trimStart():e.textDelta;if(0===r.length)break;eo=!1;let a=tX(en+=r);null!=a&&(en=a.suffix,await el({controller:t,chunk:{type:"text-delta",textDelta:a.prefix+a.whitespace}}))}else await el({controller:t,chunk:e});break;case"reasoning":t.enqueue(e),null==C?(C={type:"text",text:e.textDelta},J.push(C)):C.text+=e.textDelta;break;case"reasoning-signature":if(t.enqueue(e),null==C)throw new rh({chunk:e,message:"reasoning-signature without reasoning"});C.signature=e.signature,C=void 0;break;case"redacted-reasoning":t.enqueue(e),J.push({type:"redacted",data:e.data});break;case"tool-call":t.enqueue(e),Z.push(e);break;case"tool-result":t.enqueue(e),B.push(e);break;case"response-metadata":ea={id:null!=(r=e.id)?r:ea.id,timestamp:null!=(a=e.timestamp)?a:ea.timestamp,modelId:null!=(n=e.modelId)?n:ea.modelId};break;case"finish":{W=e.usage,V=e.finishReason,R=e.experimental_providerMetadata,N=e.logprobs;let t=b()-U;q.addEvent("ai.stream.finish"),q.setAttributes({"ai.response.msToFinish":t,"ai.response.avgCompletionTokensPerSecond":1e3*W.completionTokens/t});break}case"source":case"tool-call-streaming-start":case"tool-call-delta":t.enqueue(e);break;case"error":t.enqueue(e),V="error";break;default:throw Error(`Unknown chunk type: ${s}`)}},async flush(e){let r=Z.length>0?JSON.stringify(Z):void 0,a="done";n+1<f&&(y&&"length"===V&&0===Z.length?a="continue":Z.length>0&&B.length===Z.length&&(a="tool-result")),y&&en.length>0&&("continue"!==a||"continue"===T&&!es)&&(await el({controller:e,chunk:{type:"text-delta",textDelta:en}}),en="");try{q.setAttributes(eJ({telemetry:t,attributes:{"ai.response.finishReason":V,"ai.response.text":{output:()=>et},"ai.response.toolCalls":{output:()=>r},"ai.response.id":ea.id,"ai.response.model":ea.modelId,"ai.response.timestamp":ea.timestamp.toISOString(),"ai.usage.promptTokens":W.promptTokens,"ai.usage.completionTokens":W.completionTokens,"gen_ai.response.finish_reasons":[V],"gen_ai.response.id":ea.id,"gen_ai.response.model":ea.modelId,"gen_ai.usage.input_tokens":W.promptTokens,"gen_ai.usage.output_tokens":W.completionTokens}}))}catch(e){}finally{q.end()}e.enqueue({type:"step-finish",finishReason:V,usage:W,providerMetadata:R,experimental_providerMetadata:R,logprobs:N,request:Y,response:{...ea,headers:null==$?void 0:$.headers},warnings:D,isContinued:"continue"===a,messageId:I});let s=tP(d,W);if("done"===a)e.enqueue({type:"finish",finishReason:V,usage:s,providerMetadata:R,experimental_providerMetadata:R,logprobs:N,response:{...ea,headers:null==$?void 0:$.headers}}),Q.closeStream();else{if("continue"===T){let e=l[l.length-1];"string"==typeof e.content?e.content+=et:e.content.push({text:et,type:"text"})}else l.push(...rn({text:et,reasoning:J,tools:null!=u?u:{},toolCalls:Z,toolResults:B,messageId:I,generateMessageId:_}));await i({currentStep:n+1,responseMessages:l,usage:s,stepType:a,previousStepText:er,hasLeadingWhitespace:ei,messageId:"continue"===a?I:_()})}}})))}N=n,await i({currentStep:0,responseMessages:[],usage:{promptTokens:0,completionTokens:0,totalTokens:0},previousStepText:"",stepType:"initial",hasLeadingWhitespace:!1,messageId:_()})}}).catch(e=>{Q.addStream(new ReadableStream({start(t){t.enqueue({type:"error",error:e}),t.close()}})),Q.closeStream()})}get warnings(){return this.warningsPromise.value}get usage(){return this.usagePromise.value}get finishReason(){return this.finishReasonPromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get text(){return this.textPromise.value}get reasoning(){return this.reasoningPromise.value}get reasoningDetails(){return this.reasoningDetailsPromise.value}get sources(){return this.sourcesPromise.value}get toolCalls(){return this.toolCallsPromise.value}get toolResults(){return this.toolResultsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get steps(){return this.stepsPromise.value}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return tj(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){"text-delta"===e.type&&t.enqueue(e.textDelta)}})))}get fullStream(){return tj(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(){for await(let e of this.fullStream);}get experimental_partialOutputStream(){if(null==this.output)throw new tB;return tj(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){null!=e&&t.enqueue(e)}})))}toDataStreamInternal({getErrorMessage:e=()=>"An error occurred.",sendUsage:t=!0,sendReasoning:r=!1,sendSources:a=!1,experimental_sendFinish:n=!0}){return this.fullStream.pipeThrough(new TransformStream({transform:async(s,o)=>{let i=s.type;switch(i){case"text-delta":o.enqueue(ev("text",s.textDelta));break;case"reasoning":r&&o.enqueue(ev("reasoning",s.textDelta));break;case"redacted-reasoning":r&&o.enqueue(ev("redacted_reasoning",{data:s.data}));break;case"reasoning-signature":r&&o.enqueue(ev("reasoning_signature",{signature:s.signature}));break;case"source":a&&o.enqueue(ev("source",s.source));break;case"tool-call-streaming-start":o.enqueue(ev("tool_call_streaming_start",{toolCallId:s.toolCallId,toolName:s.toolName}));break;case"tool-call-delta":o.enqueue(ev("tool_call_delta",{toolCallId:s.toolCallId,argsTextDelta:s.argsTextDelta}));break;case"tool-call":o.enqueue(ev("tool_call",{toolCallId:s.toolCallId,toolName:s.toolName,args:s.args}));break;case"tool-result":o.enqueue(ev("tool_result",{toolCallId:s.toolCallId,result:s.result}));break;case"error":o.enqueue(ev("error",e(s.error)));break;case"step-start":o.enqueue(ev("start_step",{messageId:s.messageId}));break;case"step-finish":o.enqueue(ev("finish_step",{finishReason:s.finishReason,usage:t?{promptTokens:s.usage.promptTokens,completionTokens:s.usage.completionTokens}:void 0,isContinued:s.isContinued}));break;case"finish":n&&o.enqueue(ev("finish_message",{finishReason:s.finishReason,usage:t?{promptTokens:s.usage.promptTokens,completionTokens:s.usage.completionTokens}:void 0}));break;default:throw Error(`Unknown chunk type: ${i}`)}}}))}pipeDataStreamToResponse(e,{status:t,statusText:r,headers:a,data:n,getErrorMessage:s,sendUsage:o,sendReasoning:i,sendSources:l,experimental_sendFinish:u}={}){eI({response:e,status:t,statusText:r,headers:eA(a,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:n,getErrorMessage:s,sendUsage:o,sendReasoning:i,sendSources:l,experimental_sendFinish:u})})}pipeTextStreamToResponse(e,t){eI({response:e,status:null==t?void 0:t.status,statusText:null==t?void 0:t.statusText,headers:eA(null==t?void 0:t.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toDataStream(e){let t=this.toDataStreamInternal({getErrorMessage:null==e?void 0:e.getErrorMessage,sendUsage:null==e?void 0:e.sendUsage,sendReasoning:null==e?void 0:e.sendReasoning,sendSources:null==e?void 0:e.sendSources,experimental_sendFinish:null==e?void 0:e.experimental_sendFinish}).pipeThrough(new TextEncoderStream);return(null==e?void 0:e.data)?rw(null==e?void 0:e.data.stream,t):t}mergeIntoDataStream(e,t){e.merge(this.toDataStreamInternal({getErrorMessage:e.onError,sendUsage:null==t?void 0:t.sendUsage,sendReasoning:null==t?void 0:t.sendReasoning,sendSources:null==t?void 0:t.sendSources,experimental_sendFinish:null==t?void 0:t.experimental_sendFinish}))}toDataStreamResponse({headers:e,status:t,statusText:r,data:a,getErrorMessage:n,sendUsage:s,sendReasoning:o,sendSources:i,experimental_sendFinish:l}={}){return new Response(this.toDataStream({data:a,getErrorMessage:n,sendUsage:s,sendReasoning:o,sendSources:i,experimental_sendFinish:l}),{status:t,statusText:r,headers:eS(e,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:null!=(t=null==e?void 0:e.status)?t:200,headers:eS(null==e?void 0:e.headers,{contentType:"text/plain; charset=utf-8"})})}},rk="AI_NoSuchProviderError",rS=`vercel.ai.error.${rk}`,rA=Symbol.for(rS),rI=class extends S.eM{constructor({modelId:e,modelType:t,providerId:r,availableProviders:a,message:n=`No such provider: ${r} (available providers: ${a.join()})`}){super({errorName:rk,modelId:e,modelType:t,message:n}),this[b]=!0,this.providerId=r,this.availableProviders=a}static isInstance(e){return S.bD.hasMarker(e,rS)}};b=rA;async function rE(e,t){var a,n,s,o,i;let l;if("node"!==("undefined"!=typeof window?"browser":(null==(i=null==(o=globalThis.process)?void 0:o.release)?void 0:i.name)==="node"?"node":null))throw new ry({message:"Attempted to use child_process module outside of Node.js environment"});let u="node:";try{l=await r(51850)(`${u}child_process`)}catch(e){try{l=(null)(`${u}child_process`)}catch(e){throw new ry({message:"Failed to load child_process module dynamically",cause:e})}}let{spawn:c}=l;return c(e.command,null!=(a=e.args)?a:[],{env:null!=(n=e.env)?n:function(){let e="win32"===globalThis.process.platform?["APPDATA","HOMEDRIVE","HOMEPATH","LOCALAPPDATA","PATH","PROCESSOR_ARCHITECTURE","SYSTEMDRIVE","SYSTEMROOT","TEMP","USERNAME","USERPROFILE"]:["HOME","LOGNAME","PATH","SHELL","TERM","USER"],t={};for(let r of e){let e=globalThis.process.env[r];!(void 0===e||e.startsWith("()"))&&(t[r]=e)}return t}(),stdio:["pipe","pipe",null!=(s=e.stderr)?s:"inherit"],shell:!1,signal:t,windowsHide:"win32"===globalThis.process.platform&&"type"in globalThis.process,cwd:e.cwd})}var rR="2024-11-05",rN=[rR,"2024-10-07"],rC=R.z.object({name:R.z.string(),version:R.z.string()}).passthrough(),rP=R.z.object({_meta:R.z.optional(R.z.object({}).passthrough())}).passthrough(),rO=R.z.object({method:R.z.string(),params:R.z.optional(rP)}),rj=R.z.object({method:R.z.string(),params:R.z.optional(rP)}),rM=R.z.union([R.z.string(),R.z.number().int()]),rz=R.z.object({jsonrpc:R.z.literal("2.0"),id:rM}).merge(rO).strict(),rD=R.z.object({jsonrpc:R.z.literal("2.0"),id:rM,result:rP}).strict(),r$=R.z.object({jsonrpc:R.z.literal("2.0"),id:rM,error:R.z.object({code:R.z.number().int(),message:R.z.string(),data:R.z.optional(R.z.unknown())})}).strict(),rL=R.z.object({jsonrpc:R.z.literal("2.0")}).merge(rj).strict(),rq=R.z.union([rz,rL,rD,r$]),rU=R.z.object({experimental:R.z.optional(R.z.object({}).passthrough()),logging:R.z.optional(R.z.object({}).passthrough()),prompts:R.z.optional(R.z.object({listChanged:R.z.optional(R.z.boolean())}).passthrough()),resources:R.z.optional(R.z.object({subscribe:R.z.optional(R.z.boolean()),listChanged:R.z.optional(R.z.boolean())}).passthrough()),tools:R.z.optional(R.z.object({listChanged:R.z.optional(R.z.boolean())}).passthrough())}).passthrough(),rF=rP.extend({protocolVersion:R.z.string(),capabilities:rU,serverInfo:rC,instructions:R.z.optional(R.z.string())}),rY=rP.extend({nextCursor:R.z.optional(R.z.string())}),rZ=R.z.object({name:R.z.string(),description:R.z.optional(R.z.string()),inputSchema:R.z.object({type:R.z.literal("object"),properties:R.z.optional(R.z.object({}).passthrough())}).passthrough()}).passthrough(),rB=rY.extend({tools:R.z.array(rZ)}),rJ=R.z.object({type:R.z.literal("text"),text:R.z.string()}).passthrough(),rV=R.z.object({type:R.z.literal("image"),data:R.z.string().base64(),mimeType:R.z.string()}).passthrough(),rW=R.z.object({uri:R.z.string(),mimeType:R.z.optional(R.z.string())}).passthrough(),rH=rW.extend({text:R.z.string()}),rK=rW.extend({blob:R.z.string().base64()}),rG=R.z.object({type:R.z.literal("resource"),resource:R.z.union([rH,rK])}).passthrough(),rX=rP.extend({content:R.z.array(R.z.union([rJ,rV,rG])),isError:R.z.boolean().default(!1).optional()}).or(rP.extend({toolResult:R.z.unknown()})),rQ=class{constructor(e){this.abortController=new AbortController,this.readBuffer=new r0,this.serverParams=e}async start(){if(this.process)throw new ry({message:"StdioClientTransport already started."});return new Promise(async(e,t)=>{var r,a,n,s;try{let s=await rE(this.serverParams,this.abortController.signal);this.process=s,this.process.on("error",e=>{var r,a;if("AbortError"===e.name){null==(r=this.onClose)||r.call(this);return}t(e),null==(a=this.onError)||a.call(this,e)}),this.process.on("spawn",()=>{e()}),this.process.on("close",e=>{var t;this.process=void 0,null==(t=this.onClose)||t.call(this)}),null==(r=this.process.stdin)||r.on("error",e=>{var t;null==(t=this.onError)||t.call(this,e)}),null==(a=this.process.stdout)||a.on("data",e=>{this.readBuffer.append(e),this.processReadBuffer()}),null==(n=this.process.stdout)||n.on("error",e=>{var t;null==(t=this.onError)||t.call(this,e)})}catch(e){t(e),null==(s=this.onError)||s.call(this,e)}})}processReadBuffer(){for(var e,t;;)try{let t=this.readBuffer.readMessage();if(null===t)break;null==(e=this.onMessage)||e.call(this,t)}catch(e){null==(t=this.onError)||t.call(this,e)}}async close(){this.abortController.abort(),this.process=void 0,this.readBuffer.clear()}send(e){return new Promise(t=>{var r;if(!(null==(r=this.process)?void 0:r.stdin))throw new ry({message:"StdioClientTransport not connected"});let a=JSON.stringify(e)+"\n";this.process.stdin.write(a)?t():this.process.stdin.once("drain",t)})}},r0=class{append(e){this.buffer=this.buffer?Buffer.concat([this.buffer,e]):e}readMessage(){var e;if(!this.buffer)return null;let t=this.buffer.indexOf("\n");if(-1===t)return null;let r=this.buffer.toString("utf8",0,t);return this.buffer=this.buffer.subarray(t+1),e=r,rq.parse(JSON.parse(e))}clear(){this.buffer=void 0}},r1=class{constructor({url:e}){this.connected=!1,this.url=new URL(e)}async start(){return new Promise((e,t)=>{if(this.connected)return e();this.abortController=new AbortController,(async()=>{var r,a,n;try{let n=await fetch(this.url.href,{headers:{Accept:"text/event-stream"},signal:null==(r=this.abortController)?void 0:r.signal});if(!n.ok||!n.body){let e=new ry({message:`MCP SSE Transport Error: ${n.status} ${n.statusText}`});return null==(a=this.onError)||a.call(this,e),t(e)}let s=n.body.pipeThrough(new TextDecoderStream).pipeThrough(new EventSourceParserStream).getReader(),o=async()=>{var r,a,n;try{for(;;){let{done:t,value:n}=await s.read();if(t){if(this.connected)throw this.connected=!1,new ry({message:"MCP SSE Transport Error: Connection closed unexpectedly"});return}let{event:o,data:i}=n;if("endpoint"===o){if(this.endpoint=new URL(i,this.url),this.endpoint.origin!==this.url.origin)throw new ry({message:`MCP SSE Transport Error: Endpoint origin does not match connection origin: ${this.endpoint.origin}`});this.connected=!0,e()}else if("message"===o)try{let e=rq.parse(JSON.parse(i));null==(r=this.onMessage)||r.call(this,e)}catch(t){let e=new ry({message:"MCP SSE Transport Error: Failed to parse message",cause:t});null==(a=this.onError)||a.call(this,e)}}}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;null==(n=this.onError)||n.call(this,e),t(e)}};this.sseConnection={close:()=>s.cancel()},o()}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;null==(n=this.onError)||n.call(this,e),t(e)}})()})}async close(){var e,t,r;this.connected=!1,null==(e=this.sseConnection)||e.close(),null==(t=this.abortController)||t.abort(),null==(r=this.onClose)||r.call(this)}async send(e){var t,r,a;if(!this.endpoint||!this.connected)throw new ry({message:"MCP SSE Transport Error: Not connected"});try{let a=new Headers;a.set("Content-Type","application/json");let n={method:"POST",headers:a,body:JSON.stringify(e),signal:null==(t=this.abortController)?void 0:t.signal},s=await fetch(this.endpoint,n);if(!s.ok){let e=await s.text().catch(()=>null),t=new ry({message:`MCP SSE Transport Error: POSTing to endpoint (HTTP ${s.status}): ${e}`});null==(r=this.onError)||r.call(this,t);return}}catch(e){null==(a=this.onError)||a.call(this,e);return}}};function r2(e={}){let t=new TextEncoder,r="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(a,n){n.enqueue(t.encode(a)),r+=a,e.onToken&&await e.onToken(a),e.onText&&"string"==typeof a&&await e.onText(a)},async flush(){e.onCompletion&&await e.onCompletion(r),e.onFinal&&await e.onFinal(r)}})}function r4(e,t){return e.pipeThrough(new TransformStream({transform:async(e,t)=>{var r;if("string"==typeof e){t.enqueue(e);return}if("event"in e){"on_chat_model_stream"===e.event&&r5(null==(r=e.data)?void 0:r.chunk,t);return}r5(e,t)}})).pipeThrough(r2(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(ev("text",e))}}))}function r9(e,t){return r4(e,t).pipeThrough(new TextEncoderStream)}function r3(e,t){var r;let a=r4(e,null==t?void 0:t.callbacks).pipeThrough(new TextEncoderStream),n=null==t?void 0:t.data,s=null==t?void 0:t.init;return new Response(n?rw(n.stream,a):a,{status:null!=(r=null==s?void 0:s.status)?r:200,statusText:null==s?void 0:s.statusText,headers:eS(null==s?void 0:s.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function r8(e,t){t.dataStream.merge(r4(e,t.callbacks))}function r5(e,t){if("string"==typeof e.content)t.enqueue(e.content);else for(let r of e.content)"text"===r.type&&t.enqueue(r.text)}function r6(e,t){let r;let a=(r=!0,e=>(r&&(e=e.trimStart())&&(r=!1),e));return(0,A.NR)(e[Symbol.asyncIterator]()).pipeThrough(new TransformStream({async transform(e,t){t.enqueue(a(e.delta))}})).pipeThrough(r2(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(ev("text",e))}}))}function r7(e,t){return r6(e,t).pipeThrough(new TextEncoderStream)}function ae(e,t={}){var r;let{init:a,data:n,callbacks:s}=t,o=r6(e,s).pipeThrough(new TextEncoderStream);return new Response(n?rw(n.stream,o):o,{status:null!=(r=null==a?void 0:a.status)?r:200,statusText:null==a?void 0:a.statusText,headers:eS(null==a?void 0:a.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function at(e,t){t.dataStream.merge(r6(e,t.callbacks))}ek({},{mergeIntoDataStream:()=>r8,toDataStream:()=>r9,toDataStreamResponse:()=>r3}),ek({},{mergeIntoDataStream:()=>at,toDataStream:()=>r7,toDataStreamResponse:()=>ae});var ar=r(61749);let aa=["node_modules/**",".git/**","dist/**","build/**",".next/**","coverage/**",".cache/**",".vscode/**",".idea/**","**/*.log","**/.DS_Store","**/npm-debug.log*","**/yarn-debug.log*","**/yarn-error.log*","**/*lock.json","**/*lock.yml"];var an=r(49614),as=r.n(an),ao=r(15421);let ai="/home/project",al=/^\[Model: (.*?)\]\n\n/,au=/\[Provider: (.*?)\]\n\n/,ac="claude-3-5-sonnet-latest",ap=ao.N.getInstance(void 0),ad=ap.getAllProviders(),am=ap.getDefaultProvider(),ah={};ad.forEach(e=>{ah[e.name]={baseUrlKey:e.config.baseUrlKey,apiTokenKey:e.config.apiTokenKey}});var af=r(44276);let ag=as()().add(aa);(0,af.zP)("select-context");let ay=e=>{let{cwd:t,allowedHtmlElements:r}=e;return`
You are Bolt, an expert AI assistant and exceptional senior software developer with vast knowledge across multiple programming languages, frameworks, and best practices.

<system_constraints>
  - Operating in WebContainer, an in-browser Node.js runtime
  - Limited Python support: standard library only, no pip
  - No C/C++ compiler, native binaries, or Git
  - Prefer Node.js scripts over shell scripts
  - Use Vite for web servers
  - Databases: prefer libsql, sqlite, or non-native solutions
  - When for react dont forget to write vite config and index.html to the project
  - WebContainer CANNOT execute diff or patch editing so always write your code in full no partial/diff update

  Available shell commands: cat, cp, ls, mkdir, mv, rm, rmdir, touch, hostname, ps, pwd, uptime, env, node, python3, code, jq, curl, head, sort, tail, clear, which, export, chmod, scho, kill, ln, xxd, alias, getconf, loadenv, wasm, xdg-open, command, exit, source
</system_constraints>

<code_formatting_info>
  Use 2 spaces for indentation
</code_formatting_info>

<message_formatting_info>
  Available HTML elements: ${r.join(", ")}
</message_formatting_info>

<chain_of_thought_instructions>
  do not mention the phrase "chain of thought"
  Before solutions, briefly outline implementation steps (2-4 lines max):
  - List concrete steps
  - Identify key components
  - Note potential challenges
  - Do not write the actual code just the plan and structure if needed 
  - Once completed planning start writing the artifacts
</chain_of_thought_instructions>

<artifact_info>
  Create a single, comprehensive artifact for each project:
  - Use \`<boltArtifact>\` tags with \`title\` and \`id\` attributes
  - Use \`<boltAction>\` tags with \`type\` attribute:
    - shell: Run commands
    - file: Write/update files (use \`filePath\` attribute)
    - start: Start dev server (only when necessary)
  - Order actions logically
  - Install dependencies first
  - Provide full, updated content for all files
  - Use coding best practices: modular, clean, readable code
</artifact_info>


# CRITICAL RULES - NEVER IGNORE

## File and Command Handling
1. ALWAYS use artifacts for file contents and commands - NO EXCEPTIONS
2. When writing a file, INCLUDE THE ENTIRE FILE CONTENT - NO PARTIAL UPDATES
3. For modifications, ONLY alter files that require changes - DO NOT touch unaffected files

## Response Format
4. Use markdown EXCLUSIVELY - HTML tags are ONLY allowed within artifacts
5. Be concise - Explain ONLY when explicitly requested
6. NEVER use the word "artifact" in responses

## Development Process
7. ALWAYS think and plan comprehensively before providing a solution
8. Current working directory: \`${t} \` - Use this for all file paths
9. Don't use cli scaffolding to steup the project, use cwd as Root of the project
11. For nodejs projects ALWAYS install dependencies after writing package.json file

## Coding Standards
10. ALWAYS create smaller, atomic components and modules
11. Modularity is PARAMOUNT - Break down functionality into logical, reusable parts
12. IMMEDIATELY refactor any file exceeding 250 lines
13. ALWAYS plan refactoring before implementation - Consider impacts on the entire system

## Artifact Usage
22. Use \`<boltArtifact>\` tags with \`title\` and \`id\` attributes for each project
23. Use \`<boltAction>\` tags with appropriate \`type\` attribute:
    - \`shell\`: For running commands
    - \`file\`: For writing/updating files (include \`filePath\` attribute)
    - \`start\`: For starting dev servers (use only when necessary/ or new dependencies are installed)
24. Order actions logically - dependencies MUST be installed first
25. For Vite project must include vite config and index.html for entry point
26. Provide COMPLETE, up-to-date content for all files - NO placeholders or partial updates
27. WebContainer CANNOT execute diff or patch editing so always write your code in full no partial/diff update

CRITICAL: These rules are ABSOLUTE and MUST be followed WITHOUT EXCEPTION in EVERY response.

Examples:
<examples>
  <example>
    <user_query>Can you help me create a JavaScript function to calculate the factorial of a number?</user_query>
    <assistant_response>
      Certainly, I can help you create a JavaScript function to calculate the factorial of a number.

      <boltArtifact id="factorial-function" title="JavaScript Factorial Function">
        <boltAction type="file" filePath="index.js">function factorial(n) {
  ...
}

...</boltAction>
        <boltAction type="shell">node index.js</boltAction>
      </boltArtifact>
    </assistant_response>
  </example>

  <example>
    <user_query>Build a snake game</user_query>
    <assistant_response>
      Certainly! I'd be happy to help you build a snake game using JavaScript and HTML5 Canvas. This will be a basic implementation that you can later expand upon. Let's create the game step by step.

      <boltArtifact id="snake-game" title="Snake Game in HTML and JavaScript">
        <boltAction type="file" filePath="package.json">{
  "name": "snake",
  "scripts": {
    "dev": "vite"
  }
  ...
}</boltAction>
        <boltAction type="shell">npm install --save-dev vite</boltAction>
        <boltAction type="file" filePath="index.html">...</boltAction>
        <boltAction type="start">npm run dev</boltAction>
      </boltArtifact>

      Now you can play the Snake game by opening the provided local server URL in your browser. Use the arrow keys to control the snake. Eat the red food to grow and increase your score. The game ends if you hit the wall or your own tail.
    </assistant_response>
  </example>

  <example>
    <user_query>Make a bouncing ball with real gravity using React</user_query>
    <assistant_response>
      Certainly! I'll create a bouncing ball with real gravity using React. We'll use the react-spring library for physics-based animations.

      <boltArtifact id="bouncing-ball-react" title="Bouncing Ball with Gravity in React">
        <boltAction type="file" filePath="package.json">{
  "name": "bouncing-ball",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-spring": "^9.7.1"
  },
  "devDependencies": {
    "@types/react": "^18.0.28",
    "@types/react-dom": "^18.0.11",
    "@vitejs/plugin-react": "^3.1.0",
    "vite": "^4.2.0"
  }
}</boltAction>
        <boltAction type="file" filePath="index.html">...</boltAction>
        <boltAction type="file" filePath="src/main.jsx">...</boltAction>
        <boltAction type="file" filePath="src/index.css">...</boltAction>
        <boltAction type="file" filePath="src/App.jsx">...</boltAction>
        <boltAction type="start">npm run dev</boltAction>
      </boltArtifact>

      You can now view the bouncing ball animation in the preview. The ball will start falling from the top of the screen and bounce realistically when it hits the bottom.
    </assistant_response>
  </example>
</examples>
Always use artifacts for file contents and commands, following the format shown in these examples.
`};function av(e){return e.split("\n").map(e=>e.trim()).join("\n").trimStart().replace(/[\r\n]$/,"")}let ab=(e=ai)=>`
You are Bolt, an expert AI assistant and exceptional senior software developer with vast knowledge across multiple programming languages, frameworks, and best practices.

<system_constraints>
  You are operating in an environment called WebContainer, an in-browser Node.js runtime that emulates a Linux system to some degree. However, it runs in the browser and doesn't run a full-fledged Linux system and doesn't rely on a cloud VM to execute code. All code is executed in the browser. It does come with a shell that emulates zsh. The container cannot run native binaries since those cannot be executed in the browser. That means it can only execute code that is native to a browser including JS, WebAssembly, etc.

  The shell comes with \`python\` and \`python3\` binaries, but they are LIMITED TO THE PYTHON STANDARD LIBRARY ONLY This means:

    - There is NO \`pip\` support! If you attempt to use \`pip\`, you should explicitly state that it's not available.
    - CRITICAL: Third-party libraries cannot be installed or imported.
    - Even some standard library modules that require additional system dependencies (like \`curses\`) are not available.
    - Only modules from the core Python standard library can be used.

  Additionally, there is no \`g++\` or any C/C++ compiler available. WebContainer CANNOT run native binaries or compile C/C++ code!

  Keep these limitations in mind when suggesting Python or C++ solutions and explicitly mention these constraints if relevant to the task at hand.

  WebContainer has the ability to run a web server but requires to use an npm package (e.g., Vite, servor, serve, http-server) or use the Node.js APIs to implement a web server.

  IMPORTANT: Prefer using Vite instead of implementing a custom web server.

  IMPORTANT: Git is NOT available.

  IMPORTANT: WebContainer CANNOT execute diff or patch editing so always write your code in full no partial/diff update

  IMPORTANT: Prefer writing Node.js scripts instead of shell scripts. The environment doesn't fully support shell scripts, so use Node.js for scripting tasks whenever possible!

  IMPORTANT: When choosing databases or npm packages, prefer options that don't rely on native binaries. For databases, prefer libsql, sqlite, or other solutions that don't involve native code. WebContainer CANNOT execute arbitrary native binaries.

  Available shell commands:
    File Operations:
      - cat: Display file contents
      - cp: Copy files/directories
      - ls: List directory contents
      - mkdir: Create directory
      - mv: Move/rename files
      - rm: Remove files
      - rmdir: Remove empty directories
      - touch: Create empty file/update timestamp
    
    System Information:
      - hostname: Show system name
      - ps: Display running processes
      - pwd: Print working directory
      - uptime: Show system uptime
      - env: Environment variables
    
    Development Tools:
      - node: Execute Node.js code
      - python3: Run Python scripts
      - code: VSCode operations
      - jq: Process JSON
    
    Other Utilities:
      - curl, head, sort, tail, clear, which, export, chmod, scho, hostname, kill, ln, xxd, alias, false,  getconf, true, loadenv, wasm, xdg-open, command, exit, source
</system_constraints>

<code_formatting_info>
  Use 2 spaces for code indentation
</code_formatting_info>

<message_formatting_info>
  You can make the output pretty by using only the following available HTML elements: ${w.allowedHTMLElements.map(e=>`<${e}>`).join(", ")}
</message_formatting_info>

<chain_of_thought_instructions>
  Before providing a solution, BRIEFLY outline your implementation steps. This helps ensure systematic thinking and clear communication. Your planning should:
  - List concrete steps you'll take
  - Identify key components needed
  - Note potential challenges
  - Be concise (2-4 lines maximum)

  Example responses:

  User: "Create a todo list app with local storage"
  Assistant: "Sure. I'll start by:
  1. Set up Vite + React
  2. Create TodoList and TodoItem components
  3. Implement localStorage for persistence
  4. Add CRUD operations
  
  Let's start now.

  [Rest of response...]"

  User: "Help debug why my API calls aren't working"
  Assistant: "Great. My first steps will be:
  1. Check network requests
  2. Verify API endpoint format
  3. Examine error handling
  
  [Rest of response...]"

</chain_of_thought_instructions>

<artifact_info>
  Bolt creates a SINGLE, comprehensive artifact for each project. The artifact contains all necessary steps and components, including:

  - Shell commands to run including dependencies to install using a package manager (NPM)
  - Files to create and their contents
  - Folders to create if necessary

  <artifact_instructions>
    1. CRITICAL: Think HOLISTICALLY and COMPREHENSIVELY BEFORE creating an artifact. This means:

      - Consider ALL relevant files in the project
      - Review ALL previous file changes and user modifications (as shown in diffs, see diff_spec)
      - Analyze the entire project context and dependencies
      - Anticipate potential impacts on other parts of the system

      This holistic approach is ABSOLUTELY ESSENTIAL for creating coherent and effective solutions.

    2. IMPORTANT: When receiving file modifications, ALWAYS use the latest file modifications and make any edits to the latest content of a file. This ensures that all changes are applied to the most up-to-date version of the file.

    3. The current working directory is \`${e}\`.

    4. Wrap the content in opening and closing \`<boltArtifact>\` tags. These tags contain more specific \`<boltAction>\` elements.

    5. Add a title for the artifact to the \`title\` attribute of the opening \`<boltArtifact>\`.

    6. Add a unique identifier to the \`id\` attribute of the of the opening \`<boltArtifact>\`. For updates, reuse the prior identifier. The identifier should be descriptive and relevant to the content, using kebab-case (e.g., "example-code-snippet"). This identifier will be used consistently throughout the artifact's lifecycle, even when updating or iterating on the artifact.

    7. Use \`<boltAction>\` tags to define specific actions to perform.

    8. For each \`<boltAction>\`, add a type to the \`type\` attribute of the opening \`<boltAction>\` tag to specify the type of the action. Assign one of the following values to the \`type\` attribute:

      - shell: For running shell commands.

        - When Using \`npx\`, ALWAYS provide the \`--yes\` flag.
        - When running multiple shell commands, use \`&&\` to run them sequentially.
        - ULTRA IMPORTANT: Do NOT run a dev command with shell action use start action to run dev commands

      - file: For writing new files or updating existing files. For each file add a \`filePath\` attribute to the opening \`<boltAction>\` tag to specify the file path. The content of the file artifact is the file contents. All file paths MUST BE relative to the current working directory.

      - start: For starting a development server.
        - Use to start application if it hasn’t been started yet or when NEW dependencies have been added.
        - Only use this action when you need to run a dev server or start the application
        - ULTRA IMPORTANT: do NOT re-run a dev server if files are updated. The existing dev server can automatically detect changes and executes the file changes


    9. The order of the actions is VERY IMPORTANT. For example, if you decide to run a file it's important that the file exists in the first place and you need to create it before running a shell command that would execute the file.

    10. ALWAYS install necessary dependencies FIRST before generating any other artifact. If that requires a \`package.json\` then you should create that first!

      IMPORTANT: Add all required dependencies to the \`package.json\` already and try to avoid \`npm i <pkg>\` if possible!

    11. CRITICAL: Always provide the FULL, updated content of the artifact. This means:

      - Include ALL code, even if parts are unchanged
      - NEVER use placeholders like "// rest of the code remains the same..." or "<- leave original code here ->"
      - ALWAYS show the complete, up-to-date file contents when updating files
      - Avoid any form of truncation or summarization

    12. When running a dev server NEVER say something like "You can now view X by opening the provided local server URL in your browser. The preview will be opened automatically or by the user manually!

    13. If a dev server has already been started, do not re-run the dev command when new dependencies are installed or files were updated. Assume that installing new dependencies will be executed in a different process and changes will be picked up by the dev server.

    14. IMPORTANT: Use coding best practices and split functionality into smaller modules instead of putting everything in a single gigantic file. Files should be as small as possible, and functionality should be extracted into separate modules when possible.

      - Ensure code is clean, readable, and maintainable.
      - Adhere to proper naming conventions and consistent formatting.
      - Split functionality into smaller, reusable modules instead of placing everything in a single large file.
      - Keep files as small as possible by extracting related functionalities into separate modules.
      - Use imports to connect these modules together effectively.
  </artifact_instructions>
</artifact_info>

NEVER use the word "artifact". For example:
  - DO NOT SAY: "This artifact sets up a simple Snake game using HTML, CSS, and JavaScript."
  - INSTEAD SAY: "We set up a simple Snake game using HTML, CSS, and JavaScript."

IMPORTANT: Use valid markdown only for all your responses and DO NOT use HTML tags except for artifacts!

ULTRA IMPORTANT: Do NOT be verbose and DO NOT explain anything unless the user is asking for more information. That is VERY important.

ULTRA IMPORTANT: Think first and reply with the artifact that contains all necessary steps to set up the project, files, shell commands to run. It is SUPER IMPORTANT to respond with this first.

Here are some examples of correct usage of artifacts:

<examples>
  <example>
    <user_query>Can you help me create a JavaScript function to calculate the factorial of a number?</user_query>

    <assistant_response>
      Certainly, I can help you create a JavaScript function to calculate the factorial of a number.

      <boltArtifact id="factorial-function" title="JavaScript Factorial Function">
        <boltAction type="file" filePath="index.js">function factorial(n) {
  ...
}
...</boltAction>

        <boltAction type="shell">node index.js</boltAction>
      </boltArtifact>
    </assistant_response>
  </example>

  <example>
    <user_query>Build a snake game</user_query>

    <assistant_response>
      Certainly! I'd be happy to help you build a snake game using JavaScript and HTML5 Canvas. This will be a basic implementation that you can later expand upon. Let's create the game step by step.

      <boltArtifact id="snake-game" title="Snake Game in HTML and JavaScript">
        <boltAction type="file" filePath="package.json">{
  "name": "snake",
  "scripts": {
    "dev": "vite"
  }
  ...
}</boltAction>

        <boltAction type="shell">npm install --save-dev vite</boltAction>

        <boltAction type="file" filePath="index.html">...</boltAction>

        <boltAction type="start">npm run dev</boltAction>
      </boltArtifact>

      Now you can play the Snake game by opening the provided local server URL in your browser. Use the arrow keys to control the snake. Eat the red food to grow and increase your score. The game ends if you hit the wall or your own tail.
    </assistant_response>
  </example>

  <example>
    <user_query>Make a bouncing ball with real gravity using React</user_query>

    <assistant_response>
      Certainly! I'll create a bouncing ball with real gravity using React. We'll use the react-spring library for physics-based animations.

      <boltArtifact id="bouncing-ball-react" title="Bouncing Ball with Gravity in React">
        <boltAction type="file" filePath="package.json">{
  "name": "bouncing-ball",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-spring": "^9.7.1"
  },
  "devDependencies": {
    "@types/react": "^18.0.28",
    "@types/react-dom": "^18.0.11",
    "@vitejs/plugin-react": "^3.1.0",
    "vite": "^4.2.0"
  }
}</boltAction>

        <boltAction type="file" filePath="index.html">...</boltAction>

        <boltAction type="file" filePath="src/main.jsx">...</boltAction>

        <boltAction type="file" filePath="src/index.css">...</boltAction>

        <boltAction type="file" filePath="src/App.jsx">...</boltAction>

        <boltAction type="start">npm run dev</boltAction>
      </boltArtifact>

      You can now view the bouncing ball animation in the preview. The ball will start falling from the top of the screen and bounce realistically when it hits the bottom.
    </assistant_response>
  </example>
</examples>
`;(function(e,...t){return"string"!=typeof e?av(e.reduce((e,r,a)=>e+=r+(t[a]??""),"")):av(e)})`
  Continue your prior response. IMPORTANT: Immediately begin from where you left off without any interruptions.
  Do not repeat any content, including artifact and action tags.
`;class aw{static{this.library={default:{label:"Default Prompt",description:"This is the battle tested default system Prompt",get:e=>ab(e.cwd)},optimized:{label:"Optimized Prompt (experimental)",description:"an Experimental version of the prompt for lower token usage",get:e=>ay(e)}}}static getList(){return Object.entries(this.library).map(([e,t])=>{let{label:r,description:a}=t;return{id:e,label:r,description:a}})}static getPropmtFromLibrary(e,t){if(!this.library[e])throw"Prompt Now Found";return this.library[e]?.get(t)}}let ax=(0,af.zP)("stream-text");async function a_(e){let{messages:t,env:r,options:a,apiKeys:n,files:s,providerSettings:o,promptId:i,contextOptimization:l,contextFiles:u,summary:c}=e,p=ac,d=am.name,m=t.map(e=>{if("user"===e.role){let{model:t,provider:r,content:a}=function(e){let t=Array.isArray(e.content)?e.content.find(e=>"text"===e.type)?.text||"":e.content,r=t.match(al),a=t.match(au),n=r?r[1]:ac;return{model:n,provider:a?a[1]:am.name,content:Array.isArray(e.content)?e.content.map(e=>"text"===e.type?{type:"text",text:e.text?.replace(al,"").replace(au,"")}:e):t.replace(al,"").replace(au,"")}}(e);return p=t,d=r,{...e,content:a}}if("assistant"==e.role){let t=e.content;return t=(t=t.replace(/<div class=\\"__boltThought__\\">.*?<\/div>/s,"")).replace(/<think>.*?<\/think>/s,""),{...e,content:t}}return e}),h=ad.find(e=>e.name===d)||am,f=ao.N.getInstance().getStaticModelListFromProvider(h).find(e=>e.name===p);if(!f){let e=[...h.staticModels||[],...await ao.N.getInstance().getModelListFromProvider(h,{apiKeys:n,providerSettings:o,serverEnv:r})];if(!e.length)throw Error(`No models found for provider ${h.name}`);(f=e.find(e=>e.name===p))||(ax.warn(`MODEL [${p}] not found in provider [${h.name}]. Falling back to first model. ${e[0].name}`),f=e[0])}let g=f&&f.maxTokenAllowed?f.maxTokenAllowed:8e3,y=aw.getPropmtFromLibrary(i||"default",{cwd:ai,allowedHtmlElements:w.allowedHTMLElements,modificationTagName:"bolt_file_modifications"})??ab();if(s&&u&&l){let t;let r=function(e,t){let r=as()().add(aa),a=Object.keys(e),n=(a=a.filter(e=>{let t=e.replace("/home/project/","");return!r.ignores(t)})).filter(t=>e[t]&&"file"==e[t].type).map(r=>{let a=e[r];if(!a||"folder"==a.type)return"";let n=a.content.split("\n").join("\n"),s=r;return t&&(s=r.replace("/home/project/","")),`<boltAction type="file" filePath="${s}">${n}</boltAction>`});return`<boltArtifact id="code-content" title="Code Content" >
${n.join("\n")}
</boltArtifact>`}(u,!0),a=(t=Object.keys(s)).filter(e=>{let t=e.replace("/home/project/","");return!ag.ignores(t)});if(y=`${y}
Below are all the files present in the project:
---
${a.join("\n")}
---

Below is the artifact containing the context loaded into context buffer for you to have knowledge of and might need changes to fullfill current user request.
CONTEXT BUFFER:
---
${r}
---
`,c){if(y=`${y}
      below is the chat history till now
CHAT SUMMARY:
---
${e.summary}
---
`,e.messageSliceId)m=m.slice(e.messageSliceId);else{let e=m.pop();e&&(m=[e])}}}return ax.info(`Sending llm call to ${h.name} with model ${f.name}`),await function({model:e,tools:t,toolChoice:r,system:a,prompt:n,messages:s,maxRetries:o,abortSignal:i,headers:l,maxSteps:u=1,experimental_generateMessageId:c=r_,experimental_output:p,experimental_continueSteps:d=!1,experimental_telemetry:m,experimental_providerMetadata:h,providerOptions:f=h,experimental_toolCallStreaming:g=!1,toolCallStreaming:y=g,experimental_activeTools:v,experimental_repairToolCall:b,experimental_transform:w,onChunk:x,onError:_,onFinish:T,onStepFinish:k,_internal:{now:S=function(){var e,t;return null!=(t=null==(e=null==globalThis?void 0:globalThis.performance)?void 0:e.now())?t:Date.now()},generateId:A=rx,currentDate:I=()=>new Date}={},...E}){var R;return new rT({model:e,telemetry:m,headers:l,settings:E,maxRetries:o,abortSignal:i,system:a,prompt:n,messages:s,tools:t,toolChoice:r,toolCallStreaming:y,transforms:void 0===(R=w)?[]:Array.isArray(R)?R:[R],activeTools:v,repairToolCall:b,maxSteps:u,output:p,continueSteps:d,providerOptions:f,onChunk:x,onError:_,onFinish:T,onStepFinish:k,now:S,currentDate:I,generateId:A,generateMessageId:c})}({model:h.getModelInstance({model:f.name,serverEnv:r,apiKeys:n,providerSettings:o}),system:y,maxTokens:g,messages:tm(m),...a})}var aT=r(99968);function ak(e){return Object.entries(e).filter(([e,t])=>void 0!==t).reduce((e,[t,r])=>(e[t]=r,e),{})}async function aS(){return ar.NextResponse.json({error:"Method not allowed. Use POST instead."},{status:405})}async function aA(e){let t=ak(process.env);return ao.N.getInstance(t).updateModelList(e)}let aI=(0,af.zP)("api.llmcall");async function aE(e){try{let{system:t,message:r,model:a,provider:n,streamOutput:s}=await e.json(),{name:o}=n;if(!a||"string"!=typeof a)return ar.NextResponse.json({error:"Invalid or missing model"},{status:400});if(!o||"string"!=typeof o)return ar.NextResponse.json({error:"Invalid or missing provider"},{status:400});let i=e.headers.get("Cookie"),l=(0,aT.zw)(i),u=(0,aT.nX)(i),c=ak(process.env);if(s)try{let e=await a_({options:{system:t},messages:[{role:"user",content:`${r}`}],env:c,apiKeys:l,providerSettings:u});return new Response(e.textStream,{status:200,headers:{"Content-Type":"text/plain; charset=utf-8"}})}catch(e){if(console.log(e),e instanceof Error&&e.message?.includes("API key"))return ar.NextResponse.json({error:"Invalid or missing API key"},{status:401});return ar.NextResponse.json({error:"An unexpected error occurred"},{status:500})}else try{let e=(await aA({apiKeys:l,providerSettings:u,serverEnv:c})).find(e=>e.name===a);if(!e)return ar.NextResponse.json({error:"Model not found"},{status:404});let s=e&&e.maxTokenAllowed?e.maxTokenAllowed:8e3,o=ad.find(e=>e.name===n.name);if(!o)return ar.NextResponse.json({error:"Provider not found"},{status:404});aI.info(`Generating response Provider: ${n.name}, Model: ${e.name}`);let i=await ri({system:t,messages:[{role:"user",content:`${r}`}],model:o.getModelInstance({model:e.name,serverEnv:c,apiKeys:l,providerSettings:u}),maxTokens:s,toolChoice:"none"});return aI.info("Generated response"),ar.NextResponse.json(i)}catch(e){if(console.log(e),e instanceof Error&&e.message?.includes("API key"))return ar.NextResponse.json({error:"Invalid or missing API key"},{status:401});return ar.NextResponse.json({error:"An unexpected error occurred"},{status:500})}}catch(e){return console.error("Error processing request:",e),ar.NextResponse.json({error:"Invalid request body"},{status:400})}}let aR=new _.AppRouteRouteModule({definition:{kind:T.RouteKind.APP_ROUTE,page:"/api/llmcall/route",pathname:"/api/llmcall",filename:"route",bundlePath:"app/api/llmcall/route"},resolvedPagePath:"D:\\IA\\Applications IA\\myboltvision\\app\\api\\llmcall\\route.ts",nextConfigOutput:"",userland:x}),{workAsyncStorage:aN,workUnitAsyncStorage:aC,serverHooks:aP}=aR;function aO(){return(0,k.patchFetch)({workAsyncStorage:aN,workUnitAsyncStorage:aC})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},97512:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=97512,e.exports=t}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[488,107,968,896],()=>r(53752));module.exports=a})();